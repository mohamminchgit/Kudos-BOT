from telegram import InlineKeyboardButton, InlineKeyboardMarkup

# دیکشنری راهنماهای مختلف برای بخش‌های مختلف ربات
help_texts = {
    "main": {
        "title": "📚 راهنمای استفاده",
        "text": """به راهنمای ربات کودوس خوش آمدید!

با استفاده از این راهنما می‌توانید با بخش‌های مختلف ربات آشنا شوید.
لطفاً یکی از موضوعات زیر را انتخاب کنید:""",
        "buttons": [
            [InlineKeyboardButton("❓ سوالات متداول", callback_data="help_faq^")],
            [InlineKeyboardButton("🎯 امتیازدهی به دیگران", callback_data="help_vote^")],
            [InlineKeyboardButton("✉️ ارسال نامه", callback_data="help_letter^")],
            [InlineKeyboardButton("🏆 ترین‌های فصل", callback_data="help_top^")],
            [InlineKeyboardButton("👤 پروفایل و امتیازات", callback_data="help_profile^")],
            [InlineKeyboardButton("» بازگشت به منو", callback_data="userpanel^")]
        ]
    },
    
    "faq": {
        "title": "❓ سوالات متداول",
        "text": """🔹 ربات کودوس چیست؟
ربات کودوس یک سیستم قدردانی و امتیازدهی درون سازمانی است که به شما امکان می‌دهد از همکاران خود قدردانی کنید.

🔹 چطور می‌توانم از ربات استفاده کنم؟
شما باید توسط ادمین سیستم تأیید شوید. پس از تأیید، می‌توانید با استفاده از دکمه‌های منو، امکانات مختلف را استفاده کنید.

🔹 اعتبار چیست؟
هر کاربر در هر فصل مقدار مشخصی اعتبار دریافت می‌کند که می‌تواند آن را به دیگران اهدا کند.

🔹 فصل‌ها چه هستند؟
سیستم در قالب فصل‌های زمانی مشخص کار می‌کند. در هر فصل، کاربران اعتبار جدید دریافت می‌کنند و می‌توانند در نظرسنجی‌های ترین‌ها شرکت کنند.""",
        "buttons": [
            [InlineKeyboardButton("» بازگشت به راهنما", callback_data="help^")]
        ]
    },
    
    "vote": {
        "title": "🎯 راهنمای امتیازدهی به دیگران",
        "text": """با استفاده از بخش امتیازدهی می‌توانید به همکاران خود امتیاز بدهید و از آنها قدردانی کنید.

✨ روش امتیازدهی:
۱. ابتدا دستور /start را ارسال کنید
۲. روی دکمه «🎯 امتیازدهی به دیگران» کلیک کنید
۳. از لیست، همکار مورد نظر خود را انتخاب کنید
۴. مقدار امتیازی که می‌خواهید بدهید را انتخاب کنید
۵. دلیل امتیازدهی را بنویسید و ارسال کنید
۶. امتیاز شما پس از تأیید نهایی ثبت خواهد شد

⚠️ نکات مهم:
- هر کاربر در هر فصل مقدار مشخصی اعتبار دارد که می‌تواند به دیگران بدهد
- پس از اتمام اعتبار، امکان امتیازدهی وجود ندارد
- امتیازهای داده شده در کانال رسمی منتشر می‌شود""",
        "buttons": [
            [InlineKeyboardButton("🎯 رفتن به بخش امتیازدهی", callback_data="tovote^")],
            [InlineKeyboardButton("» بازگشت به راهنما", callback_data="help^")]
        ]
    },
    
    "letter": {
        "title": "✉️ راهنمای ارسال نامه",
        "text": """با استفاده از بخش ارسال نامه می‌توانید پیام‌های دلنشین خود را در قالب یک نامه زیبا برای همکاران خود ارسال کنید.

✨ روش ارسال نامه:
۱. ابتدا دستور /start را ارسال کنید
۲. روی دکمه «✉️ ارسال نامه» کلیک کنید
۳. از لیست، همکار مورد نظر خود را انتخاب کنید
۴. متن پیام خود را تایپ کنید و ارسال کنید
۵. نامه شما به صورت خودکار طراحی و برای گیرنده ارسال می‌شود

⚠️ نکات مهم:
- ارسال نامه کاملاً رایگان است و نیازی به اعتبار ندارد
- نامه‌ها به صورت خصوصی ارسال می‌شوند و در کانال عمومی منتشر نمی‌شوند
- سعی کنید پیام‌های مثبت و انگیزشی ارسال کنید
- متن‌های طولانی ممکن است به درستی در نامه نمایش داده نشوند""",
        "buttons": [
            [InlineKeyboardButton("✉️ رفتن به بخش ارسال نامه", callback_data="letter_start^")],
            [InlineKeyboardButton("» بازگشت به راهنما", callback_data="help^")]
        ]
    },
    
    "top": {
        "title": "🏆 راهنمای ترین‌های فصل",
        "text": """بخش ترین‌ها یک نظرسنجی دوره‌ای است که در هر فصل برگزار می‌شود و از شما خواسته می‌شود تا به سوالاتی مانند "بهترین همکار" یا "خلاق‌ترین فرد" رأی دهید.

✨ روش شرکت در نظرسنجی ترین‌ها:
۱. ابتدا دستور /start را ارسال کنید
۲. روی دکمه «🏆 ترین‌های فصل» کلیک کنید
۳. به هر یک از سوالات پاسخ دهید
۴. پس از پاسخ به همه سوالات، می‌توانید نتایج را مشاهده کنید

⚠️ نکات مهم:
- شرکت در نظرسنجی ترین‌ها اختیاری است
- پس از پاسخ به همه سوالات، نتایج برای شما قابل مشاهده خواهد بود
- در پایان هر فصل، نتایج نهایی ترین‌ها اعلام می‌شود""",
        "buttons": [
            [InlineKeyboardButton("» بازگشت به راهنما", callback_data="help^")]
        ]
    },
    
    "profile": {
        "title": "👤 راهنمای پروفایل و امتیازات",
        "text": """در بخش پروفایل و ردپای امتیازات می‌توانید اطلاعات خود و تاریخچه امتیازهای داده شده و دریافت شده را مشاهده کنید.

✨ بخش‌های مختلف:
۱. پروفایل شما: نمایش نام، یوزرنیم، اعتبار فعلی و مجموع امتیازات دریافتی
۲. ردپای امتیازات: 
   - تابلوی امتیازات: نمایش ۱۰ نفر برتر سیستم
   - امتیازهای شما: امتیازهایی که از دیگران دریافت کرده‌اید
   - امتیازهایی که دادید: امتیازهایی که به دیگران داده‌اید
   - آرشیو فصل‌ها: مشاهده آمار و اطلاعات فصل‌های قبلی

⚠️ نکات مهم:
- امتیازهای هر فصل به صورت جداگانه ثبت و نگهداری می‌شوند
- با کلیک روی لینک هر امتیاز، می‌توانید پیام مربوط به آن را در کانال مشاهده کنید
- رتبه شما بر اساس مجموع امتیازات دریافتی محاسبه می‌شود""",
        "buttons": [
            [InlineKeyboardButton("👤 پروفایل شما", callback_data="userprofile^")],
            [InlineKeyboardButton("🔍 ردپای امتیازات", callback_data="historypoints^")],
            [InlineKeyboardButton("» بازگشت به راهنما", callback_data="help^")]
        ]
    }
}

def get_help_text(help_type="main"):
    """دریافت متن راهنما و دکمه‌های مربوط به آن"""
    if help_type not in help_texts:
        help_type = "main"
        
    return {
        "title": help_texts[help_type]["title"],
        "text": help_texts[help_type]["text"],
        "buttons": help_texts[help_type]["buttons"]
    }

def handle_help_callback(data):
    """پردازش کالبک‌های مربوط به راهنما"""
    parts = data.split("^")
    
    if len(parts) > 1:
        help_type = parts[0].replace("help_", "")
    else:
        help_type = "main"
        
    return get_help_text(help_type) 
{
  "name": "SIMORGH",
  "nodes": [
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "id": "033e58ab-9bff-4372-b994-98c95e783a10",
              "leftValue": "={{ $('SIMORGH').item.json.callback_query }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "f957d831-fcf8-4f5b-bb23-7402eb6d6200",
      "name": "Check_Message_type",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        620,
        260
      ]
    },
    {
      "parameters": {
        "resource": "chat",
        "operation": "member",
        "chatId": "={{ $('BOT INFO').item.json['ch-username'] }}",
        "userId": "={{ ($('SIMORGH').item.json.callback_query?.message?.chat?.id != null && $('SIMORGH').item.json.callback_query?.message?.chat?.id !== '') ? $('SIMORGH').item.json.callback_query.message.chat.id : ($('SIMORGH').item.json.message?.from?.id != null && $('SIMORGH').item.json.message?.from?.id !== '') ? $('SIMORGH').item.json.message.from.id : ($('SIMORGH').item.json.my_chat_member?.from?.id != null && $('SIMORGH').item.json.my_chat_member.from.id !== '') ? $('SIMORGH').item.json.my_chat_member.from.id : '' }}"
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        180,
        240
      ],
      "id": "adb5912c-7f94-410a-bcc9-83656b02b2bf",
      "name": "Check Channel User",
      "webhookId": "cb738d4b-1187-4e58-a144-271036ef6b82",
      "credentials": {
        "telegramApi": {
          "id": "UWUpTV3J983xhaJy",
          "name": "SIMORGH"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "093df3c4-a8f5-45c8-9dc5-d448c3aaec76",
              "leftValue": "={{ $('Check Channel User').item.json.result.status }}",
              "rightValue": "member",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        340,
        240
      ],
      "id": "24fedf4d-2972-4461-b8b9-f96909a1d526",
      "name": "If"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "8cbf4405-ec74-43e5-bc14-ce352eea6fcb",
              "leftValue": "={{ $json.result.status }}",
              "rightValue": "creator",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            },
            {
              "id": "2628e9b7-b1dd-498a-940e-42f9df984beb",
              "leftValue": "={{ $json.result.status }}",
              "rightValue": "admin",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        420,
        60
      ],
      "id": "ceeebae5-2bcf-4764-bac9-e4fc45abd183",
      "name": "Check Creator"
    },
    {
      "parameters": {
        "chatId": "={{ $('If').item.json.result.user.id }}",
        "text": "Ø³Ù„Ø§Ù… Ø¨Ø±Ø§ÛŒ Ø§Ø¯Ø§Ù…Ù‡ ÙØ¹Ø§Ù„ÛŒØª Ù†ÛŒØ§Ø² Ù‡Ø³Øª Ú©Ù‡ Ø¯Ø§Ø®Ù„ Ú©Ø§Ù†Ø§Ù„ Ø²ÛŒØ± Ø¹Ø¶Ùˆ Ø´ÙˆÛŒØ¯ \n\nÙ¾Ø³ Ø§Ø² Ø¹Ø¶Ùˆ Ø´Ø¯Ù† Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ \"Ø¹Ø¶Ùˆ Ø´Ø¯Ù…\" Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯!",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "=Ú©Ø§Ù†Ø§Ù„ {{ $('BOT INFO').item.json['bot-name'] }}",
                    "additionalFields": {
                      "url": "={{ $('BOT INFO').item.json['ch-link'] }}"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "Ø¹Ø¶Ùˆ Ø´Ø¯Ù…!",
                    "additionalFields": {
                      "callback_data": "joinedch^"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        480,
        -120
      ],
      "id": "c9615458-0bc8-4910-9515-f4a079249e20",
      "name": "LINK JOIN",
      "webhookId": "eeb9730c-b717-44c8-9b87-b5bf6c80cd03",
      "credentials": {
        "telegramApi": {
          "id": "UWUpTV3J983xhaJy",
          "name": "SIMORGH"
        }
      }
    },
    {
      "parameters": {
        "updates": [
          "*"
        ],
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.1,
      "position": [
        -680,
        320
      ],
      "id": "3365906d-1f43-4dd2-a2b0-728efb8dfba4",
      "name": "SIMORGH",
      "webhookId": "ce491d35-166b-41ae-bf4a-377360ec0944",
      "credentials": {
        "telegramApi": {
          "id": "UWUpTV3J983xhaJy",
          "name": "SIMORGH"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "e6ada1ee-8e0e-468e-91cb-db6c5e541b6b",
              "name": "TOKEN",
              "value": "8154200439:AAEIjH2wBYrVKPomLu7ygImx3Vpry5-uf1w",
              "type": "string"
            },
            {
              "id": "c1ff6ad3-78d3-4380-bbda-b31222ba282b",
              "name": "bot-name",
              "value": "Ø³ÛŒÙ…Ø±Øº",
              "type": "string"
            },
            {
              "id": "9a2ab0d9-fae7-49c8-b2b4-211192d48a60",
              "name": "support-username",
              "value": "https://t.me/mohamminch",
              "type": "string"
            },
            {
              "id": "b1d6f329-f012-493e-866b-4c6c304ca8cc",
              "name": "admin-username",
              "value": 1983438871,
              "type": "number"
            },
            {
              "id": "af664211-d330-4c54-bb31-6dc27e2f6f00",
              "name": "ch-username",
              "value": "-1002496400244",
              "type": "string"
            },
            {
              "id": "0723502b-b95c-483d-8cb6-6361113352b5",
              "name": "ch-link",
              "value": "https://t.me/+IfWsB4WaehI3NWQ8",
              "type": "string"
            },
            {
              "id": "e940233a-b82e-4ab5-b30b-d8fd0a196cf1",
              "name": "Season",
              "value": "1",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -480,
        320
      ],
      "id": "deee9dab-8bd6-4014-b3f9-08e3dd201a22",
      "name": "BOT INFO"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.result }}",
                    "rightValue": "=menu",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Menu"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "5e0653a0-0a62-4190-9383-0882fe4494b5",
                    "leftValue": "={{ $json.result }}",
                    "rightValue": "requesttodb",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Request to db"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        1120,
        120
      ],
      "id": "ae94be46-8e28-409d-8fc6-0a7cbde2a9af",
      "name": "Switch"
    },
    {
      "parameters": {
        "jsCode": "// Ú¯Ø±ÙØªÙ† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø² Ù†ÙˆØ¯ BOT TOKEN\nconst botData = $('BOT INFO').item.json; // Ø®ÙˆØ§Ù†Ø¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù†ÙˆØ¯ BOT TOKEN\nconst botName = botData[\"bot-name\"] || \"Ù†Ø§Ù… Ø¨Ø§Øª ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡\"; // Ø¯Ø±ÛŒØ§ÙØª Ù†Ø§Ù… Ø¨Ø§Øª\nconst botsupport = botData[\"support-username\"] || \"Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ø¯Ø§Ø±Ø¯\"; // Ø¯Ø±ÛŒØ§ÙØª ÛŒÙˆØ²Ø±Ù†ÛŒÙ… Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ\n\n// Ø¯Ø±ÛŒØ§ÙØª Ù…Ù‚Ø¯Ø§Ø± original Ø§Ø² Ù†ÙˆØ¯ Ù‚Ø¨Ù„ÛŒ\nconst inputData = $('Merge Switcher data').item.json.original;\n\n// ØªØ¹Ø±ÛŒÙ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ Ùˆ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ù‡Ø± Ù…Ù‚Ø¯Ø§Ø± original\nconst responses = {\n    \"help^\": {\n        message: `ğŸ“Œ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ${botName}\\n\\n[... Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ ...]`,\n        buttons: [\n            [{ text: \"Â» Ø¨Ø§Ø²Ú¯Ø´Øª\", callback_data: \"userpanel^\" }]\n        ]\n    },\n    \"userpanel^\": {\n        message: `Ú©Ø§Ø±Ø¨Ø± Ú¯Ø±Ø§Ù…ÛŒ\\nÙ„Ø·ÙØ§ ÛŒÚ©ÛŒ Ø§Ø² Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ø±Ùˆ Ø¨Ø±Ø§ÛŒ ${botName} Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ :`,\n        buttons: [\n            [{ text: \"ğŸ¯ Ø§Ù…ØªÛŒØ§Ø²Ø¯Ù‡ÛŒ Ø¨Ù‡ Ø¯ÛŒÚ¯Ø±Ø§Ù†\", callback_data: \"tovote^\" }],\n            [\n                { text: \"Â» Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ø´Ù…Ø§\", callback_data: \"userprofile^\" },\n                { text: \"Ø±Ø¯Ù¾Ø§ÛŒ Ø§Ù…ØªÛŒØ§Ø²Ø§Øª\", callback_data: \"historypoints^\" }\n            ],\n            [\n                { text: \"Â» Ø±Ø§Ù‡Ù†Ù…Ø§\", callback_data: \"help^\" },\n                { text: \"Â» Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ\", url: `${botsupport}` }\n            ]\n        ]\n    },\n    \"historypoints^\": {\n        message: `ğŸ“Œ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø§Ù…ØªÛŒØ§Ø²Ø§Øª Ø´Ù…Ø§\\n\\nØ¯Ø± Ø§ÛŒÙ† Ø¨Ø®Ø´ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ù…ØªÛŒØ§Ø²Ù‡Ø§ÛŒÛŒ Ú©Ù‡ Ø¨Ù‡ Ø¯ÛŒÚ¯Ø±Ø§Ù† Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒØ¯ Ùˆ Ø§Ù…ØªÛŒØ§Ø²Ù‡Ø§ÛŒÛŒ Ú©Ù‡ Ø§Ø² Ø¯ÛŒÚ¯Ø±Ø§Ù† Ø¯Ø±ÛŒØ§ÙØª Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯ Ø±Ø§ Ù‡Ù…Ø±Ø§Ù‡ Ø¨Ø§ ÙˆØ¶Ø¹ÛŒØª Ø¢Ù†â€ŒÙ‡Ø§ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ù†ÛŒØ¯.\\n\\nÙ„Ø·ÙØ§Ù‹ Ø§Ø² Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ±ØŒ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯:`,\n        buttons: [\n            [{text : \"ØªØ§Ø¨Ù„ÙˆÛŒ Ø§Ù…ØªÛŒØ§Ø²Ø§Øª ğŸ†\", callback_data: \"Scoreboard^\"} ],\n            [\n            { text: \"Ø§Ù…ØªÛŒØ§Ø²Ù‡Ø§ÛŒ Ø´Ù…Ø§ ğŸ¯\", callback_data: \"receivedpoints^\" },\n            { text: \"Ø§Ù…ØªÛŒØ§Ø²Ù‡Ø§ÛŒÛŒ Ú©Ù‡ Ø¯Ø§Ø¯ÛŒØ¯ ğŸ’¬\", callback_data: \"givenpoints^\" }\n           ],\n            [{ text: \"Â» Ø¨Ø§Ø²Ú¯Ø´Øª\", callback_data: \"userpanel^\" }]\n        ]\n    },\n    \"joinedch^\": {\n        message: `ğŸ“Œ Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡ Ú©Ø§Ù†Ø§Ù„ ${botName} Ù¾ÛŒÙˆØ³ØªÛŒØ¯.`,\n        buttons: [\n            [{ text: \"Â» Ø¯Ø±ÛŒØ§ÙØª Ù…Ù†Ùˆ\", callback_data: \"userpanel^\" }]\n        ]\n    }\n};\n\n// Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ù…Ù‚Ø¯Ø§Ø± original Ø¯Ø± Ù„ÛŒØ³Øª Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ù…Ø§ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯ ÛŒØ§ Ù†Ù‡\nif (responses[inputData]) {\n    return {\n        json: {\n            message: responses[inputData].message,\n            reply_markup: {\n                inline_keyboard: responses[inputData].buttons // Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ Ù‚Ø±Ø§Ø± Ù…ÛŒâ€ŒØ¯Ù‡Ø¯ ØªØ§ Ø²ÛŒØ± Ù‡Ù… Ø¨Ø§Ø´Ù†Ø¯\n            },\n            parse_mode: \"HTML\"\n        }\n    };\n}\n\n// Ù…Ù‚Ø¯Ø§Ø± Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¯Ø± ØµÙˆØ±ØªÛŒ Ú©Ù‡ Ù…Ù‚Ø¯Ø§Ø± original Ø¯Ø± Ù„ÛŒØ³Øª Ù†Ø¨ÙˆØ¯\nreturn {\n    json: {\n        result: $json.result,\n        original: inputData\n    }\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1180,
        -60
      ],
      "id": "5f5e9af8-a58d-4f31-81c8-7442bd3b4d5f",
      "name": "Make Menu Message"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://api.telegram.org/bot{{ $('BOT INFO').item.json.TOKEN }}/editMessageText",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "chat_id",
              "value": "={{ $('SIMORGH').item.json.callback_query.from.id }}"
            },
            {
              "name": "text",
              "value": "={{ $json.message }}"
            },
            {
              "name": "reply_markup",
              "value": "={{ $json.reply_markup }}"
            },
            {
              "name": "message_id",
              "value": "={{ $('SIMORGH').item.json.callback_query.message.message_id }}"
            },
            {
              "name": "parse_mode",
              "value": "={{ $json.parse_mode }}"
            }
          ]
        },
        "options": {}
      },
      "id": "d71a3546-95ce-46ad-bd92-a8b410ee5075",
      "name": "SEND result Click Menu Layer 1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1380,
        -60
      ]
    },
    {
      "parameters": {
        "jsCode": "// Ú¯Ø±ÙØªÙ† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø² Ù†ÙˆØ¯ BOT TOKEN\nconst botData = $('BOT INFO').item.json;\nconst botName = botData[\"bot-name\"] || \"Ù†Ø§Ù… Ø¨Ø§Øª ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡\";\nconst botsupport = botData[\"support-username\"] || \"Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ø¯Ø§Ø±Ø¯\";\nconst season = botData[\"support-username\"] || \"Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ø¯Ø§Ø±Ø¯\";\n\n// Ø¯Ø±ÛŒØ§ÙØª Ù…Ù‚Ø¯Ø§Ø± original Ø§Ø² Ù†ÙˆØ¯ Ù‚Ø¨Ù„ÛŒ\nconst inputData = $('Merge Switcher data').item.json.original;\n\n// Ø³Ø§Ø®Øª Ú©ÙˆØ¦Ø±ÛŒ SQL Ø¨Ø±Ø§ÛŒ userprofile^\nif (inputData === \"userprofile^\") {\n    const userId = $item(\"0\").$node[\"SIMORGH\"].json[\"callback_query\"]?.message?.chat?.id || \n                  $item(\"0\").$node[\"SIMORGH\"][\"message\"]?.from?.id;\n    if (userId && !isNaN(userId)) {\n        const query = `\n            SELECT \n                u.*, \n                u.balance AS user_balance,\n                (SELECT SUM(t.amount) \n                 FROM transactions t\n                 WHERE t.touser = u.user_id) AS total_amount\n            FROM \n                users u\n            WHERE \n                u.user_id = ${userId};\n        `;\n        return {\n            json: { query: query, \"Output Query Execution Details\": false }\n        };\n    } else {\n        return {\n            json: {\n                error: \"Ø´Ù†Ø§Ø³Ù‡ Ú©Ø§Ø±Ø¨Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯ ÛŒØ§ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª\",\n                status: \"error\"\n            }\n        };\n    }\n} else if (inputData.startsWith(\"tovote^\")) {\n    const userId = $item(\"0\").$node[\"SIMORGH\"].json[\"callback_query\"]?.message?.chat?.id ||\n                   $item(\"0\").$node[\"SIMORGH\"][\"message\"]?.from?.id;\n    const parts = inputData.split(\"^\");\n    if (parts.length === 3) { // e.g. \"tovote^180497899^2\"\n        const query = `\n            SELECT *\n            FROM \\`users\\`\n            WHERE \\`user_id\\` = ${userId};\n        `;\n        return { json: { query: query, \"Output Query Execution Details\": false } };\n    } else {\n        const suffix = inputData.slice(\"tovote^\".length);\n        if (suffix) { // numeric suffix provided e.g. \"tovote^1412414\"\n            if (!isNaN(Number(suffix))) {\n                const query = `\n                    SELECT *\n                    FROM \\`users\\`\n                    WHERE \\`user_id\\` = ${userId};\n                `;\n                return { json: { query: query, \"Output Query Execution Details\": false } };\n            }\n            // ...optional: handle non-numeric suffix if needed...\n        } else { // exactly \"tovote^\"\n            const seasonId = $('BOT INFO').item.json.Season;\n            const query = `\n                SELECT s.*, \n                    (SELECT JSON_ARRAYAGG(\n                        CASE\n                            WHEN user_id = ${userId} THEN JSON_OBJECT(\n                                'self_id', id,\n                                'self_user_id', user_id,\n                                'self_username', username,\n                                'self_balance', balance,\n                                'self_created_at', created_at,\n                                'self_birthday', birthday,\n                                'self_name', name\n                            )\n                            ELSE JSON_OBJECT(\n                                'id', id,\n                                'user_id', user_id,\n                                'username', username,\n                                'balance', balance,\n                                'created_at', created_at,\n                                'birthday', birthday,\n                                'name', name\n                            )\n                        END\n                    ) FROM users) AS all_users\n                FROM Season s\n                WHERE s.id = ${seasonId};\n            `;\n            return { json: { query: query, \"Output Query Execution Details\": false } };\n        }\n    }\n} else if (inputData.startsWith(\"givenpoints^\")) {    // modified condition to handle givenpoints^ and givenpoints^number\n    const userId = $item(\"0\").$node[\"SIMORGH\"].json[\"callback_query\"]?.message?.chat?.id || \n                  $item(\"0\").$node[\"SIMORGH\"][\"message\"]?.from?.id;\n    const query = `\n        SELECT DISTINCT\n            t.transaction_id, \n            t.user_id, \n            t.amount, \n            t.created_at, \n            COALESCE(utouser.name, 'gotovote^') AS touser_name,\n            t.touser AS touser_user_id,\n            t.season_id, \n            t.message_id, \n            t.reason, \n            COALESCE(uuser.name, 'gotovote^') AS main_user_name\n        FROM \n            transactions t\n        LEFT JOIN \n            users utouser ON t.touser = utouser.user_id\n        LEFT JOIN \n            users uuser ON t.user_id = uuser.user_id\n        WHERE \n            t.user_id = ${userId}\n\n        UNION ALL\n\n        SELECT\n            NULL AS transaction_id, \n            ${userId} AS user_id, \n            NULL AS amount, \n            NULL AS created_at, \n            'gotovote^' AS touser_name,\n            NULL AS touser_user_id,\n            NULL AS season_id, \n            NULL AS message_id, \n            NULL AS reason, \n            'gotovote^' AS main_user_name\n        WHERE NOT EXISTS (\n            SELECT 1 FROM transactions t WHERE t.user_id = ${userId}\n        );\n    `;\n    return {\n        json: { query: query, \"Output Query Execution Details\": true }\n    };\n} else if (inputData.startsWith(\"receivedpoints^\")) {\n    const userId = $item(\"0\").$node[\"SIMORGH\"].json[\"callback_query\"]?.message?.chat?.id || \n                  $item(\"0\").$node[\"SIMORGH\"][\"message\"]?.from?.id;\n\n    const query = `\n        SELECT DISTINCT\n            t.transaction_id, \n            t.user_id, \n            t.amount, \n            t.created_at, \n            COALESCE(utouser.name, 'gotovote^') AS touser_name,\n            t.touser AS touser_user_id,\n            t.season_id, \n            t.message_id, \n            t.reason, \n            COALESCE(uuser.name, 'gotovote^') AS main_user_name\n        FROM \n            transactions t\n        LEFT JOIN \n            users utouser ON t.touser = utouser.user_id\n        LEFT JOIN \n            users uuser ON t.user_id = uuser.user_id\n        WHERE \n            t.touser = ${userId}\n    `;\n    return {\n        json: { query: query, \"Output Query Execution Details\": true }\n    };\n} else if (inputData === \"Scoreboard^\") { // new branch for Scoreboard^ input\n    const query = `\n        SELECT \n            t.touser AS touser_user_id,\n            COALESCE(u.name, 'Unknown') AS touser_name,\n            SUM(t.amount) AS sum_amount\n        FROM \n            transactions t\n        LEFT JOIN \n            users u ON t.touser = u.user_id\n        GROUP BY \n            t.touser, u.name\n        ORDER BY \n            SUM(t.amount) DESC;\n    `;\n    return {\n        json: { query: query, \"Output Query Execution Details\": true }\n    };\n} else if (inputData.startsWith(\"Confirm^\")) {\n    const parts = inputData.split(\"^\");\n    const data_touser = parts[1];\n    const data_amount = parts[2];\n    const userId = $item(\"0\").$node[\"SIMORGH\"].json[\"callback_query\"].message.chat.id ||\n                   $item(\"0\").$node[\"SIMORGH\"].json[\"message\"].chat.id;\n    // Updated reason extraction from SIMORGH node\n    let simText = $('SIMORGH').item.json.callback_query.message.text;\n    let reasonMatch = simText.match(/Ø¯Ù„ÛŒÙ„\\s*:\\s*([\\s\\S]*?)(?=\\n-+)/);\n    const reasonText = reasonMatch ? reasonMatch[1].trim() : \"\";\n    const query = `\n        SELECT balance INTO @current_balance\n        FROM users\n        WHERE user_id = ${userId};\n\n        SET @sufficient_balance = @current_balance >= ${data_amount};\n\n        UPDATE users\n        SET balance = balance - ${data_amount}\n        WHERE user_id = ${userId} AND @sufficient_balance;\n\n        INSERT INTO transactions (user_id, amount, touser, season_id, message_id, reason)\n        SELECT ${userId}, ${data_amount}, ${data_touser}, ${$('BOT INFO').item.json.Season}, NULL, '${reasonText}'\n        FROM dual\n        WHERE @sufficient_balance;\n\n        SELECT \n            u.balance AS updated_balance,\n            t.transaction_id,\n            t.amount,\n            t.touser,\n            u2.name AS touser_name,\n            t.season_id,\n            t.message_id,\n            t.reason,\n            CASE\n                WHEN @sufficient_balance THEN 'false'\n                ELSE 'true'\n            END AS Insufficientcredit\n        FROM users u\n        LEFT JOIN transactions t ON t.user_id = u.user_id\n        LEFT JOIN users u2 ON u2.user_id = t.touser\n        WHERE u.user_id = ${userId}\n        ORDER BY t.transaction_id DESC\n        LIMIT 1;\n    `;\n    return { json: { query: query, \"Output Query Execution Details\": false } };\n} else {\n    return {\n        json: {\n            result: $json.result || \"Ù†ØªÛŒØ¬Ù‡â€ŒØ§ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯\",\n            original: inputData\n        }\n    };\n}\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1340,
        140
      ],
      "id": "af3109ea-6bbd-4de3-92a8-78a6648631af",
      "name": "Make query"
    },
    {
      "parameters": {
        "jsCode": "// Ú¯Ø±ÙØªÙ† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø² Ù†ÙˆØ¯ BOT TOKEN\nconst botData = $('BOT INFO').item.json; // Ø®ÙˆØ§Ù†Ø¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù†ÙˆØ¯ BOT TOKEN\nconst bottoken = botData[\"TOKEN\"] || \"ØªØ¹ÛŒÛŒÙ† Ù†Ø´Ø¯Ù‡\"; // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù…Ù‚Ø¯Ø§Ø± ØªÙˆÚ©Ù† Ø¨Ø§Øª\nconst botName = botData[\"bot-name\"] || \"Ù†Ø§Ù… Ø¨Ø§Øª ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡\";\nconst chat = botData[\"support-username\"];\nconst botsupport = botData[\"support-username\"] || \"Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ø¯Ø§Ø±Ø¯\";\nconst chatuserid = botData[\"ch-username\"] || \"ÛŒÙˆØ²Ø¢ÛŒØ¯ÛŒ Ú†Ù†Ù„ ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡\";\n\n// Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± (Ø¨Ø±Ø§ÛŒ chat_id)\n// ØªØºÛŒÛŒØ± Ø§ÛŒÙ† Ø®Ø· Ø¨Ø±Ø§ÛŒ Ú¯Ø±ÙØªÙ† ID Ú©Ø§Ø±Ø¨Ø± Ø¨Ù‡ ØµÙˆØ±Øª Ù…Ø³ØªÙ‚ÛŒÙ…Ø´\nconst userData = $item(\"0\").$node[\"SIMORGH\"].json[\"callback_query\"]?.message?.chat.id ||\n                 $item(\"0\").$node[\"SIMORGH\"].json[\"message\"]?.chat.id;\n\n// Ø¯Ø±ÛŒØ§ÙØª Ù…Ù‚Ø¯Ø§Ø± original Ø§Ø² Ù†ÙˆØ¯ Ù‚Ø¨Ù„ÛŒ\nconst inputData = $('Merge Switcher data').item.json.original;\n\n// Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±\nconst userId = $item(\"0\").$node[\"SIMORGH\"].json[\"callback_query\"]?.message?.chat?.username || \n               $item(\"0\").$node[\"SIMORGH\"].json[\"message\"]?.from?.username;\n\n// Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø± Ø§Ø² Ù†ÙˆØ¯ Request-to-db\nconst userBalance = $item(\"0\").$node[\"Request-to-db\"].json.balance || \"0\";\n\n// Ø¬Ø¯Ø§ Ú©Ø±Ø¯Ù† Ø³Ù‡ Ø±Ù‚Ù… Ø³Ù‡ Ø±Ù‚Ù… Ù…ÙˆØ¬ÙˆØ¯ÛŒ\nconst formattedBalance = userBalance.replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n\n// Ø¯Ø±ÛŒØ§ÙØª Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø± Ø§Ø² Ù†ÙˆØ¯ Request-to-db\nconst userName = $item(\"0\").$node[\"Request-to-db\"].json.name || \"Ù†Ø§Ù… ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡\";\n\n// ØªØ¹Ø±ÛŒÙ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ Ùˆ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ù‡Ø± Ù…Ù‚Ø¯Ø§Ø± original\nconst responses = {\n    \"userprofile^\": {\n        message: `Ù†Ø§Ù… Ø´Ù…Ø§: @${userId}\\nØ§Ù…ØªÛŒØ§Ø² Ø´Ù…Ø§: ${formattedBalance} Ø§Ø¹ØªØ¨Ø§Ø±`,\n        buttons: [\n            [{ text: \"Â» Ø¨Ø§Ø²Ú¯Ø´Øª\", callback_data: \"userpanel^\" }]\n        ]\n    }\n    // Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ú©Ù„ÛŒØ¯ÙˆØ§Ú˜Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯ÛŒÚ¯Ø± Ø±Ø§ Ø¨Ù‡ Ø§ÛŒÙ†Ø¬Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯\n};\n\n// Check for the new \"tovote^\" input before the existing response branch\nif (inputData === \"tovote^\") {\n    const dbData = $item(\"0\").$node[\"Request-to-db\"].json;\n    // Ensure dbData exists as an object (season info is outside an array)\n    if (!dbData) {\n        return {\n            url: `https://api.telegram.org/bot${bottoken}/editMessageText`,\n            method: \"POST\",\n            parameters: {\n                message_id: $('SIMORGH').item.json.callback_query.message.message_id,\n                chat_id: userData, // updated to use the new chat id\n                text: \"Season data not available\",\n                parse_mode: \"HTML\"\n            }\n        };\n    }\n    const season = dbData;\n    const seasonTitle = season && season.name ? \"#\" + season.name.replace(/ /g, \"_\") : \"#UntitledSeason\";\n    let currentUser = null;\n    // Changed from season[\"aa users\"] to season.all_users\n    if (season.all_users) {\n        currentUser = season.all_users.find(u =>\n            (u.self_username ? u.self_username === userId : u.username === userId)\n        );\n    }\n    const currentUserBalance = currentUser ? (currentUser.self_balance || currentUser.balance) : \"0\";\n    \n    // Build inline keyboard: two buttons per row using names from season.all_users, with numbering\n    let buttons = [];\n    if (season.all_users) {\n        let counter = 1;\n        let tempRow = [];\n        season.all_users.forEach(u => {\n            // Skip current user entry if it contains the self identifier\n            if (u.self_id !== undefined) {\n                return; // skip self user\n            }\n            const displayName = `${counter}- ${u.name || u.self_name}`;\n            const uid = u.user_id || u.self_user_id;\n            tempRow.push({ text: displayName, callback_data: `tovote^${uid}` });\n            counter++;\n            if (tempRow.length === 2) {\n                buttons.push(tempRow);\n                tempRow = [];\n            }\n        });\n        if (tempRow.length > 0) {\n            buttons.push(tempRow);\n        }\n    }\n    // Add back button row at the end\n    buttons.push([{ text: \"Â» Ø¨Ø§Ø²Ú¯Ø´Øª\", callback_data: \"userpanel^\" }]);\n    \n    return {\n        url: `https://api.telegram.org/bot${bottoken}/editMessageText`,\n        method: \"POST\",\n        parameters: {\n            message_id: $('SIMORGH').item.json.callback_query.message.message_id,\n            chat_id: userData, // updated to use the new chat id\n            text: `${seasonTitle}\\n\\nØªÙˆ ${currentUserBalance} Ø§Ù…ØªÛŒØ§Ø² Ø¯Ø§Ø±ÛŒ Ú©Ù‡ Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ Ø¨Ù‡ Ø¯ÙˆØ³ØªØ§Øª Ø¨Ø¯ÛŒ ğŸ\\n\\nØ§Ø² Ø¨ÛŒÙ† Ø§ÙØ±Ø§Ø¯ Ø²ÛŒØ±ØŒ Ø¨Ù‡ Ú©ÛŒ Ù…ÛŒâ€ŒØ®ÙˆØ§ÛŒ Ø§Ù…ØªÛŒØ§Ø² Ø¨Ø¯ÛŒØŸ ğŸ¤”`,\n            parse_mode: \"HTML\",\n            reply_markup: {\n                inline_keyboard: buttons\n            }\n        }\n    };\n} else if (inputData === 'givenpoints^') {\n    // Handle first page: show first 2 transactions only\n    const transactions = $item(\"0\").$node[\"Request-to-db\"].json;\n    if (transactions && Array.isArray(transactions.data) && transactions.data.length > 0 && transactions.data[0].transaction_id !== null) {\n        const txData = transactions.data;\n        const pageSize = 3;\n        const pageData = txData.slice(0, pageSize);\n        let message = `Ø³Ù„Ø§Ù… ${txData[0].main_user_name} Ø¹Ø²ÛŒØ²!\\nğŸ“Œ Ø§Ù…ØªÛŒØ§Ø²Ù‡Ø§ÛŒÛŒ Ú©Ù‡ Ø¯Ø§Ø¯ÛŒ Ø¨Ù‡ Ø§ÛŒÙ† Ø´Ø±Ø­ Ø²ÛŒØ± Ø§Ø³Øª:\\n\\n`;\n        pageData.forEach(tx => {\n            // Modified link generation using tx.message_id instead of tx.transaction_id\n            let link = tx.message_id ? `<a href=\"https://t.me/c/${chatuserid.replace('-100','')}/${tx.message_id}\">[Ù„ÛŒÙ†Ú©]</a>` : 'Ù„ÛŒÙ†Ú© Ù†Ø¯Ø§Ø±Ø¯';\n            message += `âœ… Ø´Ù…Ø§ ${tx.amount} Ø§Ù…ØªÛŒØ§Ø² Ø¨Ù‡ ${tx.touser_name} Ø¯Ø§Ø¯ÛŒØ¯: ${link}\\nğŸ“„ ${tx.reason}\\n\\n`;\n        });\n        let buttons = [];\n        if (txData.length > pageSize) {\n            buttons.push([\n                { text: \"Ø¨Ø§Ø²Ú¯Ø´Øª\", callback_data: \"userpanel^\" },\n                { text: \"â¡ï¸ ØµÙØ­Ù‡ Ø¨Ø¹Ø¯\", callback_data: `givenpoints^${txData[pageSize].transaction_id}` }\n            ]);\n        } else {\n            // Always include \"Ø¨Ø§Ø²Ú¯Ø´Øª\" button if less than pageSize records\n            buttons.push([{ text: \"Ø¨Ø§Ø²Ú¯Ø´Øª\", callback_data: \"userpanel^\" }]);\n        }\n        return {\n            url: `https://api.telegram.org/bot${bottoken}/editMessageText`,\n            method: \"POST\",\n            parameters: {\n                message_id: $('SIMORGH').item.json.callback_query.message.message_id,\n                chat_id: userData,\n                text: message,\n                parse_mode: \"HTML\",\n                reply_markup: { inline_keyboard: buttons }\n            }\n        };\n    } else {\n        return {\n            url: `https://api.telegram.org/bot${bottoken}/editMessageText`,\n            method: \"POST\",\n            parameters: {\n                message_id: $('SIMORGH').item.json.callback_query.message.message_id,\n                chat_id: userData,\n                text: \"Ø´Ù…Ø§ ØªØ§ Ø§Ù„Ø§Ù† Ù‡ÛŒÚ† Ø§Ù…ØªÛŒØ§Ø²ÛŒ Ù†Ø¯Ø§Ø¯ÛŒ!\",\n                parse_mode: \"HTML\",\n                reply_markup: {\n                    inline_keyboard: [\n                        [\n                            { text: \"Ø¨Ø§Ø²Ú¯Ø´Øª\", callback_data: \"historypoints^\" },\n                            { text: \"ğŸ¯ Ø§Ù…ØªÛŒØ§Ø² Ø¨Ø¯Ù‡!\", callback_data: \"tovote^\" }\n                        ]\n                    ]\n                }\n            }\n        };\n    }\n} else if (inputData.startsWith(\"givenpoints^\") && inputData !== \"givenpoints^\") {\n    // Handle subsequent pages: input format givenpoints^number\n    const parts = inputData.split(\"^\");\n    const startId = Number(parts[1]);\n    const transactions = $item(\"0\").$node[\"Request-to-db\"].json;\n    if (transactions && Array.isArray(transactions.data) && transactions.data.length > 0) {\n        const txData = transactions.data;\n        const pageSize = 2;\n        const startIndex = txData.findIndex(tx => tx.transaction_id === startId);\n        if (startIndex === -1) {\n            return {\n                url: `https://api.telegram.org/bot${bottoken}/editMessageText`,\n                method: \"POST\",\n                parameters: {\n                    message_id: $('SIMORGH').item.json.callback_query.message.message_id,\n                    chat_id: userData,\n                    text: \"Ù…ÙˆØ±Ø¯ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.\",\n                    parse_mode: \"HTML\"\n                }\n            };\n        }\n        const pageData = txData.slice(startIndex, startIndex + pageSize);\n        let message = `Ø³Ù„Ø§Ù… ${pageData[0].main_user_name} Ø¹Ø²ÛŒØ²!\\nğŸ“Œ Ø§Ù…ØªÛŒØ§Ø²Ù‡Ø§ÛŒÛŒ Ú©Ù‡ Ø¯Ø§Ø¯ÛŒ Ø¨Ù‡ Ø§ÛŒÙ† Ø´Ø±Ø­ Ø²ÛŒØ± Ø§Ø³Øª:\\n\\n`;\n        pageData.forEach(tx => {\n            // Modified link generation using tx.message_id instead of tx.transaction_id\n            let link = tx.message_id ? `<a href=\"https://t.me/c/${chatuserid.replace('-100','')}/${tx.message_id}\">[Ù„ÛŒÙ†Ú©]</a>` : 'Ù„ÛŒÙ†Ú© Ù†Ø¯Ø§Ø±Ø¯';\n            message += `âœ… Ø´Ù…Ø§ ${tx.amount} Ø§Ù…ØªÛŒØ§Ø² Ø¨Ù‡ ${tx.touser_name} Ø¯Ø§Ø¯ÛŒØ¯: ${link}\\nğŸ“„ ${tx.reason}\\n\\n`;\n        });\n        let navButtons = [];\n        if (startIndex > 0) {\n            const prevIndex = Math.max(0, startIndex - pageSize);\n            navButtons.push({ text: \"â¬…ï¸ ØµÙØ­Ù‡ Ù‚Ø¨Ù„ÛŒ\", callback_data: `givenpoints^${txData[prevIndex].transaction_id}` });\n        }\n        if (startIndex + pageSize < txData.length) {\n            navButtons.push({ text: \"â¡ï¸ ØµÙØ­Ù‡ Ø¨Ø¹Ø¯\", callback_data: `givenpoints^${txData[startIndex + pageSize].transaction_id}` });\n        }\n        if (navButtons.length === 0) {\n            navButtons.push({ text: \"Ø¨Ø§Ø²Ú¯Ø´Øª\", callback_data: \"userpanel^\" });\n        } else if (navButtons.length === 1) {\n            navButtons.push({ text: \"Ø¨Ø§Ø²Ú¯Ø´Øª\", callback_data: \"userpanel^\" });\n        }\n        return {\n            url: `https://api.telegram.org/bot${bottoken}/editMessageText`,\n            method: \"POST\",\n            parameters: {\n                message_id: $('SIMORGH').item.json.callback_query.message.message_id,\n                chat_id: userData,\n                text: message,\n                parse_mode: \"HTML\",\n                reply_markup: { inline_keyboard: [ navButtons ] }\n            }\n        };\n    } else {\n        return {\n            url: `https://api.telegram.org/bot${bottoken}/editMessageText`,\n            method: \"POST\",\n            parameters: {\n                message_id: $('SIMORGH').item.json.callback_query.message.message_id,\n                chat_id: userData,\n                text: \"Ø´Ù…Ø§ ØªØ§ Ø§Ù„Ø§Ù† Ù‡ÛŒÚ† Ø§Ù…ØªÛŒØ§Ø²ÛŒ Ù†Ø¯Ø§Ø¯ÛŒ!\",\n                parse_mode: \"HTML\",\n                reply_markup: {\n                    inline_keyboard: [\n                        [\n                            { text: \"Ø¨Ø§Ø²Ú¯Ø´Øª\", callback_data: \"historypoints^\" },\n                            { text: \"ğŸ¯ Ø§Ù…ØªÛŒØ§Ø² Ø¨Ø¯Ù‡!\", callback_data: \"tovote^\" }\n                        ]\n                    ]\n                }\n            }\n        };\n    }\n} else if (inputData === \"receivedpoints^\") {\n    // Handle first page for receivedpoints: show first 2 transactions only\n    const transactions = $item(\"0\").$node[\"Request-to-db\"].json;\n    if (transactions && Array.isArray(transactions.data) && transactions.data.length > 0) {\n        const txData = transactions.data;\n        const pageSize = 2;\n        const pageData = txData.slice(0, pageSize);\n        const mainName = pageData[0].touser_name;\n        let message = `Ø³Ù„Ø§Ù… ${mainName}Ø¹Ø²ÛŒØ²!\\nğŸ“Œ Ø§Ù…ØªÛŒØ§Ø²Ù‡Ø§ÛŒÛŒ Ú©Ù‡ Ø¨Ù‡Øª Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡ Ø±Ùˆ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ø¨ÛŒÙ†:\\n\\n`;\n        pageData.forEach(tx => {\n            let transactionLink = \"\";\n            if (tx.message_id) {\n            const link = `https://t.me/c/${chatuserid.replace('-100','')}/${tx.message_id}`;\n            transactionLink = `<a href=\"${link}\">[Ù„ÛŒÙ†Ú©]</a>`;\n            } else {\n            transactionLink = \"Ù„ÛŒÙ†Ú© Ù†Ø¯Ø§Ø±Ø¯\";\n            }\n            message += `âœ… ${tx.main_user_name} ${tx.amount} Ø§Ù…ØªÛŒØ§Ø² Ø¨Ù‡Øª Ø¯Ø§Ø¯Ù‡ : ${transactionLink}\\n`;\n            message += `ğŸ“„ ${tx.reason}\\n\\n`;\n        });\n        let buttons = [];\n        if (txData.length > pageSize) {\n            buttons.push([\n                { text: \"Ø¨Ø§Ø²Ú¯Ø´Øª\", callback_data: \"userpanel^\" },\n                { text: \"â¡ï¸ ØµÙØ­Ù‡ Ø¨Ø¹Ø¯\", callback_data: `receivedpoints^${txData[pageSize].transaction_id}` }\n            ]);\n        } else {\n            buttons.push([{ text: \"Ø¨Ø§Ø²Ú¯Ø´Øª\", callback_data: \"userpanel^\" }]);\n        }\n        return {\n            url: `https://api.telegram.org/bot${bottoken}/editMessageText`,\n            method: \"POST\",\n            parameters: {\n                message_id: $('SIMORGH').item.json.callback_query.message.message_id,\n                chat_id: userData,\n                text: message,\n                parse_mode: \"HTML\",\n                reply_markup: { inline_keyboard: buttons }\n            }\n        };\n    } else {\n        return {\n            url: `https://api.telegram.org/bot${bottoken}/editMessageText`,\n            method: \"POST\",\n            parameters: {\n                message_id: $('SIMORGH').item.json.callback_query.message.message_id,\n                chat_id: userData,\n                text: \"Ø´Ù…Ø§ ØªØ§ Ø§Ù„Ø§Ù† Ù‡ÛŒÚ† Ø§Ù…ØªÛŒØ§Ø²ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ù†Ú©Ø±Ø¯ÛŒØ¯!\",\n                parse_mode: \"HTML\",\n                reply_markup: { inline_keyboard: [[{ text: \"Ø¨Ø§Ø²Ú¯Ø´Øª\", callback_data: \"userpanel^\" }]] }\n            }\n        };\n    }\n} else if (inputData.startsWith(\"receivedpoints^\") && inputData !== \"receivedpoints^\") {\n    // Handle subsequent pages: input format receivedpoints^number\n    const parts = inputData.split(\"^\");\n    const startId = Number(parts[1]);\n    const transactions = $item(\"0\").$node[\"Request-to-db\"].json;\n    if (transactions && Array.isArray(transactions.data) && transactions.data.length > 0) {\n        const txData = transactions.data;\n        const pageSize = 2;\n        const startIndex = txData.findIndex(tx => tx.transaction_id === startId);\n        if (startIndex === -1) {\n            return {\n                url: `https://api.telegram.org/bot${bottoken}/editMessageText`,\n                method: \"POST\",\n                parameters: {\n                    message_id: $('SIMORGH').item.json.callback_query.message.message_id,\n                    chat_id: userData,\n                    text: \"Ù…ÙˆØ±Ø¯ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.\",\n                    parse_mode: \"HTML\"\n                }\n            };\n        }\n        const pageData = txData.slice(startIndex, startIndex + pageSize);\n        const mainName = pageData[0].touser_name;\n        let message = `Ø³Ù„Ø§Ù… ${mainName} Ø¹Ø²ÛŒØ²!\\nğŸ“Œ Ø§Ù…ØªÛŒØ§Ø²Ù‡Ø§ÛŒÛŒ Ú©Ù‡ Ø¨Ù‡Øª Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡ Ø±Ùˆ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ø¨ÛŒÙ†:\\n\\n`;\n        pageData.forEach(tx => {\n            let transactionLink = \"\";\n            if (tx.message_id !== null && tx.message_id !== \"\") {\n                const link = `https://t.me/c/${chatuserid.replace('-100','')}/${tx.message_id}`;\n                transactionLink = `<a href=\"${link}\">[Ù„ÛŒÙ†Ú©]</a>`;\n            } else {\n                transactionLink = \"Ù„ÛŒÙ†Ú© Ù†Ø¯Ø§Ø±Ø¯\";\n            }\n            message += `âœ… ${tx.main_user_name} ${tx.amount} Ø§Ù…ØªÛŒØ§Ø² Ø¨Ù‡Øª Ø¯Ø§Ø¯Ù‡ : ${transactionLink}\\n`;\n            message += `ğŸ“„ ${tx.reason}\\n\\n`;\n        });\n        let navButtons = [];\n        if (startIndex > 0) {\n            const prevIndex = Math.max(0, startIndex - pageSize);\n            navButtons.push({ text: \"â¬…ï¸ ØµÙØ­Ù‡ Ù‚Ø¨Ù„ÛŒ\", callback_data: `receivedpoints^${txData[prevIndex].transaction_id}` });\n        }\n        if (startIndex + pageSize < txData.length) {\n            navButtons.push({ text: \"â¡ï¸ ØµÙØ­Ù‡ Ø¨Ø¹Ø¯\", callback_data: `receivedpoints^${txData[startIndex + pageSize].transaction_id}` });\n        }\n        if (navButtons.length === 0) {\n            navButtons.push({ text: \"Ø¨Ø§Ø²Ú¯Ø´Øª\", callback_data: \"userpanel^\" });\n        } else if (navButtons.length === 1) {\n            navButtons.push({ text: \"Ø¨Ø§Ø²Ú¯Ø´Øª\", callback_data: \"userpanel^\" });\n        }\n        return {\n            url: `https://api.telegram.org/bot${bottoken}/editMessageText`,\n            method: \"POST\",\n            parameters: {\n                message_id: $('SIMORGH').item.json.callback_query.message.message_id,\n                chat_id: userData,\n                text: message,\n                parse_mode: \"HTML\",\n                reply_markup: { inline_keyboard: [ navButtons ] }\n            }\n        };\n    } else {\n        return {\n            url: `https://api.telegram.org/bot${bottoken}/editMessageText`,\n            method: \"POST\",\n            parameters: {\n                message_id: $('SIMORGH').item.json.callback_query.message.message_id,\n                chat_id: userData,\n                text: \"Ø´Ù…Ø§ ØªØ§ Ø§Ù„Ø§Ù† Ù‡ÛŒÚ† Ø§Ù…ØªÛŒØ§Ø²ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ù†Ú©Ø±Ø¯ÛŒØ¯!\",\n                parse_mode: \"HTML\",\n                reply_markup: { inline_keyboard: [[{ text: \"Ø¨Ø§Ø²Ú¯Ø´Øª\", callback_data: \"userpanel^\" }]] }\n            }\n        };\n    }\n} else if (inputData.startsWith(\"tovote^\") && inputData !== \"tovote^\") {\n    const parts = inputData.split(\"^\");\n    let extract_name = \"\";\n    if (parts.length === 3 && !isNaN(Number(parts[2]))) {\n        // Case: \"tovote^ID^number\" â†’ extract name from message text\n        let voteAmount = Number(parts[2]);\n        let rawBalance = $item(\"0\").$node[\"Request-to-db\"].json.balance || \"0\";\n        let balanceValue = parseInt(rawBalance, 10);\n        if (voteAmount <= balanceValue) {\n            const simText = $('SIMORGH').item.json.callback_query.message.text;\n            let match = simText.match(/Ø¨Ù‡\\s+(.*?)\\s+Ù‡Ø³ØªÛŒØ¯/);\n            extract_name = match ? match[1] : \"\";\n            // Remove leading digits, possible spaces, hyphen and spaces\n            extract_name = extract_name.replace(/^(?:\\d+\\s*\\-\\s*)/, \"\");\n            // Additionally remove a leading \"Ø§Ù…ÛŒÙ†\" if present\n            extract_name = extract_name.replace(/^Ø§Ù…ÛŒÙ†\\s*/, \"\");\n            // Fallback if extraction returns empty\n            if (!extract_name) {\n                let fallback = simText.match(/Ø¨Ù‡\\s+(.+?)\\s+\\d+\\s+Ø§Ù…ØªÛŒØ§Ø²/);\n                extract_name = fallback ? fallback[1] : \"\";\n                extract_name = extract_name.replace(/^(?:\\d+\\s*\\-\\s*)/, \"\");\n                extract_name = extract_name.replace(/^Ø§Ù…ÛŒÙ†\\s*/, \"\");\n            }\n            const msg = `Ø´Ù…Ø§ Ù…ÛŒØ®ÙˆØ§ÛŒ Ø¨Ù‡ ${extract_name}ØŒ ${voteAmount} Ø§Ù…ØªÛŒØ§Ø² Ø¨Ø¯ÛŒ!\\n\\nğŸ’¬ Ø¹Ù„Øª Ø§Ù…ØªÛŒØ§Ø² Ø±Ùˆ Ø±ÙˆÛŒ Ù‡Ù…ÛŒÙ† Ù¾ÛŒØ§Ù… Ø±ÛŒÙ¾Ù„Ø§ÛŒ Ú©Ù†.`;\n            return {\n                url: `https://api.telegram.org/bot${bottoken}/editMessageText`,\n                method: \"POST\",\n                parameters: {\n                    message_id: $('SIMORGH').item.json.callback_query.message.message_id,\n                    chat_id: userData,\n                    text: msg,\n                    parse_mode: \"HTML\",\n                    reply_markup: {\n                        inline_keyboard: [[{ text: \"Ø§Ù†ØµØ±Ø§Ù\", callback_data: `Cancel^${parts[1]}^${parts[2]}` }]]\n                    }\n                }\n            };\n        }\n    } else if (parts.length === 2) {\n        // Case: \"tovote^ID\" â†’ extract name from callback_data (inline_keyboard)\n        let replyMarkup = $('SIMORGH').item.json.callback_query.message.reply_markup;\n        let inlineButtons = replyMarkup.inline_keyboard;\n        for (let row of inlineButtons) {\n            for (let btn of row) {\n                if (btn.callback_data === inputData) {\n                    // Remove leading digits, hyphen and spaces from the button text\n                    extract_name = btn.text.replace(/^(?:\\d+\\s*-\\s*)/, \"\");\n                    break;\n                }\n            }\n        }\n        // Build inline keyboard buttons from 1 to balance (3 per row)\n        let rawBalance = $item(\"0\").$node[\"Request-to-db\"].json.balance || \"0\";\n        let balanceValue = parseInt(rawBalance, 10);\n        if (balanceValue > 0) {\n            let numberButtons = [];\n            let tempRow = [];\n            for (let i = 1; i <= balanceValue; i++) {\n                tempRow.push({ text: i.toString(), callback_data: `${inputData}^${i}` });\n                if (tempRow.length === 3) {\n                    numberButtons.push(tempRow);\n                    tempRow = [];\n                }\n            }\n            if (tempRow.length > 0) {\n                numberButtons.push(tempRow);\n            }\n            numberButtons.push([{ text: \"Â» Ø¨Ø§Ø²Ú¯Ø´Øª\", callback_data: \"userpanel^\" }]);\n            const msg = `Ø´Ù…Ø§ Ø¯Ø± Ø­Ø§Ù„ Ø§Ù…ØªÛŒØ§Ø² Ø¯Ø§Ø¯Ù† Ø¨Ù‡ ${extract_name} Ù‡Ø³ØªÛŒØ¯!\\n\\nØ¯Ø±Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± Ø´Ù…Ø§ ${rawBalance} Ø§Ù…ØªÛŒØ§Ø² Ø¯Ø§Ø±ÛŒØ¯ Ú©Ù‡ Ù…ÛŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.\\n\\nÙ„Ø·ÙØ§ Ù…Ù‚Ø¯Ø§Ø± Ø§Ù…ØªÛŒØ§Ø²ÛŒ Ú©Ù‡ Ù…ÛŒØ®ÙˆØ§ÛŒ Ø¨Ø¯ÛŒ Ø±Ùˆ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù† :`;\n            return {\n                url: `https://api.telegram.org/bot${bottoken}/editMessageText`,\n                method: \"POST\",\n                parameters: {\n                    message_id: $('SIMORGH').item.json.callback_query.message.message_id,\n                    chat_id: userData,\n                    text: msg,\n                    parse_mode: \"HTML\",\n                    reply_markup: { inline_keyboard: numberButtons }\n                }\n            };\n        } else {\n            // No balance\n            return {\n                url: `https://api.telegram.org/bot${bottoken}/editMessageText`,\n                method: \"POST\",\n                parameters: {\n                    message_id: $('SIMORGH').item.json.callback_query.message.message_id,\n                    chat_id: userData,\n                    text: \"Ø´Ù…Ø§ Ù‡Ù…Ù‡ Ø§Ù…ØªÛŒØ§Ø²Ø§Øª Ø®ÙˆØ¯ Ø±Ø§ Ø®Ø±Ø¬ Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯!\",\n                    parse_mode: \"HTML\",\n                    reply_markup: {\n                        inline_keyboard: [\n                            [{ text: \"Ø§Ù…ØªÛŒØ§Ø²Ù‡Ø§ÛŒÛŒ Ú©Ù‡ Ø¯Ø§Ø¯ÛŒØ¯\", callback_data: \"givenpoints^\" }],\n                            [{ text: \"Â» Ø¨Ø§Ø²Ú¯Ø´Øª\", callback_data: \"userpanel^\" }]\n                        ]\n                    }\n                }\n            };\n        }\n    }\n} else if (inputData === \"Scoreboard^\") { // modified branch for scoreboard message\n    const scoreboard = $item(\"0\").$node[\"Request-to-db\"].json.data;\n    if (!(scoreboard && Array.isArray(scoreboard))) {\n        return {\n            url: `https://api.telegram.org/bot${bottoken}/editMessageText`,\n            method: \"POST\",\n            parameters: {\n                message_id: $('SIMORGH').item.json.callback_query.message.message_id,\n                chat_id: userData,\n                text: \"Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ø±ØªØ¨Ù‡â€ŒØ¨Ù†Ø¯ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.\",\n                parse_mode: \"HTML\"\n            }\n        };\n    }\n    // Sort by sum_amount (converted to number) descending\n    scoreboard.sort((a, b) => Number(b.sum_amount) - Number(a.sum_amount));\n    \n    let message = \"Ø±ØªØ¨Ù‡â€ŒØ¨Ù†Ø¯ÛŒ Ø§Ù…ØªÛŒØ§Ø²Ø§Øª:\\n\\n\";\n    let rank = 0, counter = 0, prevScore = null;\n    scoreboard.forEach(item => {\n        counter++;\n        const score = Number(item.sum_amount);\n        if (prevScore === null || score !== prevScore) {\n            rank = counter;\n        }\n        let medal = \"\";\n        if (rank === 1) {\n            medal = \"ğŸ¥‡ \";\n        } else if (rank === 2) {\n            medal = \"ğŸ¥ˆ \";\n        } else if (rank === 3) {\n            medal = \"ğŸ¥‰ \";\n        }\n        prevScore = score;\n        let displayName = item.touser_name;\n        // Spoiler the name if userData matches touser_user_id\n        if (Number(userData) === item.touser_user_id) {\n            displayName = `<tg-spoiler>${displayName}</tg-spoiler>`;\n        }\n        message += `${rank}- ${medal}${displayName} ${score}\\n`;\n    });\n    \n    return {\n        url: `https://api.telegram.org/bot${bottoken}/editMessageText`,\n        method: \"POST\",\n        parameters: {\n            message_id: $('SIMORGH').item.json.callback_query.message.message_id,\n            chat_id: userData,\n            text: message,\n            parse_mode: \"HTML\",\n            reply_markup: {\n                inline_keyboard: [\n                    [{ text: \"Ø¨Ø§Ø²Ú¯Ø´Øª\", callback_data: \"userpanel^\" }]\n                ]\n            }\n        }\n    };\n} else if (inputData === \"userprofile^\") {\n    const dbData = $item(\"0\").$node[\"Request-to-db\"].json;\n    const userProfile = Array.isArray(dbData) ? dbData[0] : dbData;\n    const balance = userProfile.user_balance || 0;\n    const totalAmount = userProfile.total_amount == null ? 0 : userProfile.total_amount;\n    const message = `Ø³Ù„Ø§Ù… ${userName} Ø¹Ø²ÛŒØ²!âœŒğŸ»\n\nğŸ’° Ø§Ø¹ØªØ¨Ø§Ø± Ø´Ù…Ø§: ${balance}\nğŸ† Ø§Ù…ØªÛŒØ§Ø²Ø§Øª Ø¯Ø±ÛŒØ§ÙØªÛŒ ØªØ§ Ø§ÛŒÙ† Ù„Ø­Ø¸Ù‡: ${totalAmount}`;\n    return {\n        url: `https://api.telegram.org/bot${bottoken}/editMessageText`,\n        method: \"POST\",\n        parameters: {\n            message_id: $('SIMORGH').item.json.callback_query.message.message_id,\n            chat_id: userData,\n            text: message,\n            parse_mode: \"HTML\",\n            reply_markup: {\n                inline_keyboard: [\n                    [{ text: \"Ø¨Ø§Ø²Ú¯Ø´Øª\", callback_data: \"userpanel^\" }]\n                ]\n            }\n        }\n    };\n} else if (inputData.startsWith(\"Confirm^\")) {\n    // Assume the output of the \"Request-to-db\" node is already available\n    const dbRes = $item(\"0\").$node[\"Request-to-db\"].json;\n    let message = \"\";\n    let keyboard = [];\n    if (dbRes) {\n        let res = Array.isArray(dbRes) ? dbRes[0] : dbRes;\n        if (res.Insufficientcredit === 'true') {\n            message = `Ø§Ø¹ØªØ¨Ø§Ø± Ø´Ù…Ø§ Ø¨Ø±Ø§ÛŒ Ø±Ø§ÛŒ Ø¯Ø§Ø¯Ù† Ø¨Ù‡ ${res.touser_name} Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª!`;\n            keyboard = [\n                [{ text: \"Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø¹ØªØ¨Ø§Ø± Ù…Ù†\", callback_data: \"userprofile^\" }],\n                [{ text: \"Ø¨Ø±Ú¯Ø´Øª\", callback_data: \"userpanel^\" }]\n            ];\n        } else if (res.amount && res.touser_name) {\n            message = `Ø´Ù…Ø§ ${res.amount} Ø§Ù…ØªÛŒØ§Ø² Ø¨Ù‡ ${res.touser_name} Ø¯Ø§Ø¯ÛŒ! Ùˆ Ù†ÙˆØ´ØªÛŒ: ${res.reason}`;\n            keyboard = [\n                [ \n                    {text: \"Ø¨Ø§Ø²Ú¯Ø´Øª\", callback_data: \"userpanel^\" },\n                    { text: \"Ø±Ø¯Ù¾Ø§ÛŒ Ø§Ù…ØªÛŒØ§Ø²Ø§Øª ğŸ‘£\", callback_data: \"historypoints^\" }\n               ]\n            ];\n        } else {\n            message = \"Ù†ØªÛŒØ¬Ù‡â€ŒØ§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ù†Ø´Ø¯.\";\n            keyboard = [[{ text: \"Ø¨Ø±Ú¯Ø´Øª\", callback_data: \"userpanel^\" }]];\n        }\n    }\n    return {\n        url: `https://api.telegram.org/bot${bottoken}/editMessageText`,\n        method: \"POST\",\n        parameters: {\n            message_id: $('SIMORGH').item.json.callback_query.message.message_id,\n            chat_id: userData,\n            text: message,\n            parse_mode: \"HTML\",\n            reply_markup: {\n                inline_keyboard: keyboard\n            }\n        }\n    };\n} else if (responses[inputData]) {\n    return {\n        url: `https://api.telegram.org/bot${bottoken}/editMessageText`,\n        method: \"POST\",\n        parameters: {\n            message_id: $('SIMORGH').item.json.callback_query.message.message_id,\n            chat_id: userData, // updated to use the new chat id\n            text: responses[inputData].message,\n            parse_mode: \"HTML\",\n            reply_markup: {\n                inline_keyboard: responses[inputData].buttons // Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ Ù‚Ø±Ø§Ø± Ù…ÛŒâ€ŒØ¯Ù‡Ø¯ ØªØ§ Ø²ÛŒØ± Ù‡Ù… Ø¨Ø§Ø´Ù†Ø¯\n            }\n        }\n    };\n}\n\n// Ù…Ù‚Ø¯Ø§Ø± Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¯Ø± ØµÙˆØ±ØªÛŒ Ú©Ù‡ Ù…Ù‚Ø¯Ø§Ø± original Ø¯Ø± Ù„ÛŒØ³Øª Ù†Ø¨ÙˆØ¯\nreturn {\n    url: `https://api.telegram.org/bot${bottoken}/editMessageText`,\n    method: \"POST\",\n    parameters: {\n        message_id: $('SIMORGH').item.json.callback_query.message.message_id,\n        chat_id: userData, // updated to use the new chat id\n        text: `${$json.result}\\noriginal: ${inputData}`,\n        parse_mode: \"HTML\"\n    }\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1680,
        140
      ],
      "id": "1e44cb54-b9b2-46e7-b20e-6c0dfbc48426",
      "name": "Make Menu Message2"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "{{ $json.query }}\n",
        "options": {
          "detailedOutput": "={{ $json[\"Output Query Execution Details\"] }}"
        }
      },
      "id": "57689e53-fd77-458e-a49d-c60b4bf669e5",
      "name": "Request-to-db",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        1520,
        140
      ],
      "alwaysOutputData": false,
      "credentials": {
        "mySql": {
          "id": "pZDfMlNbrmUUGmXF",
          "name": "Simorgh"
        }
      }
    },
    {
      "parameters": {
        "method": "={{ $json.method }}",
        "url": "={{ $json.url }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $json.parameters }}",
        "options": {}
      },
      "id": "bd5c832d-283c-4e83-ba66-5b76108cfff6",
      "name": "SEND result Click Menu Layer 2",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1880,
        140
      ]
    },
    {
      "parameters": {
        "jsCode": "// ØªØ¹Ø±ÛŒÙ Ù„ÛŒØ³Øªâ€ŒÙ‡Ø§\nconst firstList = [\"help^\", \"userpanel^\", \"historypoints^\", \"joinedch^\"];\nconst secondList = [\"userprofile^\", \"tovote^\", \"givenpoints^\", \"receivedpoints^\", \"Scoreboard^\"];\n// Ù„ÛŒØ³Øª Ø§Ø³ØªØ«Ù†Ø§Ù¾Ø§Øª\nconst exceptionList = {\n  \"Confirm^\": (inp) => inp,  // Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ§Ø±Ø¯ÛŒ Ú©Ù‡ Ø¨Ø§ Confirm^ Ø´Ø±ÙˆØ¹ Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŒ Ø®Ø±ÙˆØ¬ÛŒ Ù‡Ù…Ø§Ù† ÙˆØ±ÙˆØ¯ÛŒ Ø®ÙˆØ§Ù‡Ø¯ Ø¨ÙˆØ¯\n  \"givenpoints^\": (inp) => inp, // Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ§Ø±Ø¯ÛŒ Ú©Ù‡ Ø¨Ø§ givenpoints^ Ø´Ø±ÙˆØ¹ Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŒ Ø®Ø±ÙˆØ¬ÛŒ Ù‡Ù…Ø§Ù† ÙˆØ±ÙˆØ¯ÛŒ Ø®ÙˆØ§Ù‡Ø¯ Ø¨ÙˆØ¯\n  \"receivedpoints^\": (inp) => inp  // Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ§Ø±Ø¯ÛŒ Ú©Ù‡ Ø¨Ø§ receivedpoints^ Ø´Ø±ÙˆØ¹ Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŒ Ø®Ø±ÙˆØ¬ÛŒ Ù‡Ù…Ø§Ù† ÙˆØ±ÙˆØ¯ÛŒ Ø®ÙˆØ§Ù‡Ø¯ Ø¨ÙˆØ¯\n};\n\n// Ø¯Ø§Ø¯Ù‡ ÙˆØ±ÙˆØ¯ÛŒ\nconst inputData = $('SIMORGH').item.json.callback_query.data;\n\n// Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ ÙˆØ±ÙˆØ¯ÛŒ Ø¯Ø± Ú©Ø¯Ø§Ù… ÛŒÚ© Ø§Ø² Ù„ÛŒØ³Øªâ€ŒÙ‡Ø§ Ù‚Ø±Ø§Ø± Ø¯Ø§Ø±Ø¯\nlet result = \"\";\nif (inputData.startsWith(\"Cancel^\")) {\n  result = \"menu\";\n} else if (inputData.startsWith(\"Confirm^\")) {\n  result = \"requesttodb\";\n} else if (inputData.startsWith(\"givenpoints^\")) {\n  result = \"requesttodb\";  // new branch for givenpoints^ inputs\n} else if (inputData.startsWith(\"receivedpoints^\")) {\nresult = \"requesttodb\";  // new branch for givenpoints^ inputs\n} else if (firstList.includes(inputData)) {\n  result = \"menu\";  // Ø§Ú¯Ø± ÙˆØ±ÙˆØ¯ÛŒ Ø¯Ø± Ù„ÛŒØ³Øª Ø§ÙˆÙ„ Ø¨Ø§Ø´Ø¯\n} else if (inputData.startsWith(\"tovote^\")) {\n  result = \"requesttodb\";  // Ø§Ú¯Ø± ÙˆØ±ÙˆØ¯ÛŒ Ø¨Ø§ tovote^ Ø´Ø±ÙˆØ¹ Ø´ÙˆØ¯\n} else if (secondList.includes(inputData)) {\n  result = \"requesttodb\";  // Ø­Ø§Ù„Øª Ù¾ÛŒØ´ÙØ±Ø¶ Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ§Ø±Ø¯ Ù…ÙˆØ¬ÙˆØ¯ Ø¯Ø± Ø¯ÙˆÙ…ÛŒÙ† Ù„ÛŒØ³Øª\n} else {\n  result = \"Ù†ÛŒØ³Øª\";  // Ø§Ú¯Ø± ÙˆØ±ÙˆØ¯ÛŒ Ø¯Ø± Ù‡ÛŒÚ† Ú©Ø¯Ø§Ù… Ø§Ø² Ù„ÛŒØ³Øªâ€ŒÙ‡Ø§ Ù†Ø¨Ø§Ø´Ø¯\n}\n\n// ØªØ¹ÛŒÛŒÙ† original Ø¨Ø± Ø§Ø³Ø§Ø³ Ù„ÛŒØ³Øª Ø§Ø³ØªØ«Ù†Ø§Ù¾Ø§Øª\nlet originalValue = inputData.startsWith(\"Cancel^\") ? \"userpanel^\" : inputData;\nfor (const prefix in exceptionList) {\n  if (inputData.startsWith(prefix)) {\n    originalValue = exceptionList[prefix](inputData);\n    break;\n  }\n}\n\nreturn [{\n  result: result,\n  original: originalValue\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        920,
        120
      ],
      "id": "1efa2adf-4673-48c2-8cd9-da533b84de9f",
      "name": "Merge Switcher data"
    },
    {
      "parameters": {
        "jsCode": "const message = $('SIMORGH').item.json.message;\n\n// If there's a reply and its callback_data starts with \"Cancel^\", return the reply_text.\nif (message.reply_to_message && \n    message.reply_to_message.reply_markup && \n    message.reply_to_message.reply_markup.inline_keyboard &&\n    message.reply_to_message.reply_markup.inline_keyboard[0] &&\n    message.reply_to_message.reply_markup.inline_keyboard[0][0] &&\n    message.reply_to_message.reply_markup.inline_keyboard[0][0].callback_data &&\n    message.reply_to_message.reply_markup.inline_keyboard[0][0].callback_data.startsWith(\"Cancel^\")\n) {\n  return [{\n    result: \"Confirm\",\n    original: message.text,\n    reply_text: message.reply_to_message.text\n  }];\n}\n\nconst inputData = message.text;\n\nconst result = (inputData === \"/start\" , \"/start start\") ? \"start-bot\" \n             : (inputData === \"/tools\") ? \"tools-bot\" \n             : \"Ù†ÛŒØ³Øª\";\n\nreturn [{\n  result: result,\n  original: inputData\n}];\n\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        660,
        600
      ],
      "id": "88f569da-328b-4dfe-804f-c5ea05a83c4a",
      "name": "Merge Switcher text"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Merge Switcher text').item.json.result }}",
                    "rightValue": "=start-bot",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "start"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "fdf6ce2b-aec6-47ca-abf8-f59826247e61",
                    "leftValue": "={{ $('Merge Switcher text').item.json.result }}",
                    "rightValue": "tools-bot",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "=Tools"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "646e53f4-90b2-4722-aa0c-3c743c5aa0e2",
                    "leftValue": "={{ $('Merge Switcher text').item.json.result }}",
                    "rightValue": "Confirm",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Confirm"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        840,
        600
      ],
      "id": "b34d4fed-055b-4518-9930-a1c4a6359bd3",
      "name": "Switch1"
    },
    {
      "parameters": {
        "jsCode": "// Ú¯Ø±ÙØªÙ† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø² Ù†ÙˆØ¯ BOT TOKEN\nconst botData = $('BOT INFO').item.json;\nconst botName = botData[\"bot-name\"] || \"Ù†Ø§Ù… Ø¨Ø§Øª ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡\";\nconst botsupport = botData[\"support-username\"] || \"Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ø¯Ø§Ø±Ø¯\";\nconst botadmin = botData[\"admin-username\"] || \"Ø§Ø¯Ù…ÛŒÙ† Ù†Ø¯Ø§Ø±Ø¯\";\n\n// Ú¯Ø±ÙØªÙ† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±\nconst inputData = $('Merge Switcher text').item.json.original;\nconst userData = $('SIMORGH').item.json.message.from;\nconst isAdmin = userData[\"id\"] === botadmin;\n\n// ØªØ¹Ø±ÛŒÙ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ Ùˆ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§\nconst responses = {\n  \"/start\": {\n    \"start\": {\n      message: `Ú©Ø§Ø±Ø¨Ø± Ú¯Ø±Ø§Ù…ÛŒ\\nÙ„Ø·ÙØ§ ÛŒÚ©ÛŒ Ø§Ø² Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ø±Ùˆ Ø¨Ø±Ø§ÛŒ ${botName} Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ :`,\n      buttons: [\n        [{ text: \"ğŸ¯ Ø§Ù…ØªÛŒØ§Ø²Ø¯Ù‡ÛŒ Ø¨Ù‡ Ø¯ÛŒÚ¯Ø±Ø§Ù†\", callback_data: \"tovote^\" }],\n        [\n          { text: \"Â» Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ø´Ù…Ø§\", callback_data: \"userprofile^\" },\n          { text: \"Ø±Ø¯Ù¾Ø§ÛŒ Ø§Ù…ØªÛŒØ§Ø²Ø§Øª\", callback_data: \"historypoints^\" }\n        ],\n        [\n          { text: \"Â» Ø±Ø§Ù‡Ù†Ù…Ø§\", callback_data: \"help^\" },\n          { text: \"Â» Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ\", url: `${botsupport}` }\n        ]\n      ]\n    }\n  },\n  \"admin_panel\": {\n    message: `Ø§Ø¯Ù…ÛŒÙ† Ú¯Ø±Ø§Ù…ÛŒ\\nØ¨Ù‡ Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª ${botName} Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ :`,\n    buttons: [\n      [{ text: \"Â» Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†\", callback_data: \"manageusers^\" }],\n      [{ text: \"Â» Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§\", callback_data: \"reports^\" }],\n      [{ text: \"Â» ØªÙ†Ø¸ÛŒÙ…Ø§Øª\", callback_data: \"settings^\" }]\n    ]\n  }\n};\n\n// ØªØµÙ…ÛŒÙ…â€ŒÚ¯ÛŒØ±ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ inputData\nlet response;\n\nif (inputData === \"/start\" || inputData === \"/start start\") {\n  if (isAdmin) {\n    response = responses[\"admin_panel\"];\n  } else {\n    response = responses[\"/start\"][\"start\"];\n  }\n}\n\nif (response) {\n  return {\n    json: {\n      message: response.message,\n      reply_markup: {\n        inline_keyboard: response.buttons\n      },\n      parse_mode: \"HTML\"\n    }\n  };\n}\n\n// Ù…Ù‚Ø¯Ø§Ø± Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø§Ú¯Ø± Ú†ÛŒØ²ÛŒ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯\nreturn {\n  json: {\n    result: $json.result,\n    original: inputData\n  }\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1040,
        360
      ],
      "id": "b8b5cfa5-4eb5-4c15-ac58-fb185f34ebf1",
      "name": "Make Menu Message1"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://api.telegram.org/bot{{ $('BOT INFO').item.json.TOKEN }}/SendMessage",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "chat_id",
              "value": "={{ $('SIMORGH').item.json.message.from.id }}"
            },
            {
              "name": "text",
              "value": "={{ $('Make Menu Message1').item.json.message }}"
            },
            {
              "name": "reply_markup",
              "value": "={{ $('Make Menu Message1').item.json.reply_markup }}"
            },
            {
              "name": "parse_mode",
              "value": "={{ $('Make Menu Message1').item.json.parse_mode }}"
            }
          ]
        },
        "options": {}
      },
      "id": "d6b4abb5-b432-4c81-b73b-4f8e637fd4bb",
      "name": "SEND result Click Menu Layer ",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1220,
        360
      ]
    },
    {
      "parameters": {
        "jsCode": "// Ú¯Ø±ÙØªÙ† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø² Ù†ÙˆØ¯ BOT TOKEN\nconst botData = $('BOT INFO').item.json; // Ø®ÙˆØ§Ù†Ø¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù†ÙˆØ¯ BOT TOKEN\nconst botName = botData[\"bot-name\"] || \"Ù†Ø§Ù… Ø¨Ø§Øª ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡\"; // Ø¯Ø±ÛŒØ§ÙØª Ù†Ø§Ù… Ø¨Ø§Øª\nconst botsupport = botData[\"support-username\"] || \"Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ø¯Ø§Ø±Ø¯\"; // Ø¯Ø±ÛŒØ§ÙØª ÛŒÙˆØ²Ø±Ù†ÛŒÙ… Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ\nconst botadmin = botData[\"admin-username\"] || \"Ø§Ø¯Ù…ÛŒÙ† Ù†Ø¯Ø§Ø±Ø¯\"; // Ø¯Ø±ÛŒØ§ÙØª ÛŒÙˆØ²Ø±Ù†ÛŒÙ… Ø§Ø¯Ù…ÛŒÙ†\n\n// Ø¯Ø±ÛŒØ§ÙØª Ù…Ù‚Ø¯Ø§Ø± original Ø§Ø² Ù†ÙˆØ¯ Ù‚Ø¨Ù„ÛŒ\nconst inputData = $('Merge Switcher text').item.json.original;\nconst userData = $('SIMORGH').item.json.message.from; // ÙØ±Ø¶ Ú©Ù†ÛŒØ¯ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± Ø±Ø§ Ø§Ø² Ù†ÙˆØ¯ User Info Ù…ÛŒâ€ŒÚ¯ÛŒØ±ÛŒØ¯\nconst isAdmin = userData[\"id\"] === botadmin; // Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ú©Ø§Ø±Ø¨Ø± Ø§Ø¯Ù…ÛŒÙ† Ø§Ø³Øª ÛŒØ§ Ù†Ù‡\n\n// ØªØ¹Ø±ÛŒÙ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ Ùˆ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ù‡Ø± Ù…Ù‚Ø¯Ø§Ø± original\nconst responses = {\n    \"/tools\": {\n        message: `Ú©Ø§Ø±Ø¨Ø± Ú¯Ø±Ø§Ù…ÛŒ\\nÙ„Ø·ÙØ§ ÛŒÚ©ÛŒ Ø§Ø² Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ø±Ùˆ Ø¨Ø±Ø§ÛŒ ${botName} Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ :`,\n        buttons: [\n            [{ text: \"Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ø§ÛŒÙ‡ ğŸ¦µ\", callback_data: \"baseinfo^\" }],\n            [{ text: \"ØªØ§Ø±ÛŒØ®Ú†Ù‡ \", callback_data: \"historytools^\" }],\n            [\n                { text: \"Â» Ø±Ø§Ù‡Ù†Ù…Ø§\", callback_data: \"helptools^\" },\n                { text: \"Â» Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ\", url: `${botsupport}` }\n            ]\n        ]\n    }\n};\n// Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ù…Ù‚Ø¯Ø§Ø± original Ø¯Ø± Ù„ÛŒØ³Øª Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ù…Ø§ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯ ÛŒØ§ Ù†Ù‡\nif (responses[inputData]) {\n    const response = responses[inputData];\n    return {\n        json: {\n            message: response.message,\n            reply_markup: {\n                inline_keyboard: response.buttons // Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ Ù‚Ø±Ø§Ø± Ù…ÛŒâ€ŒØ¯Ù‡Ø¯ ØªØ§ Ø²ÛŒØ± Ù‡Ù… Ø¨Ø§Ø´Ù†Ø¯\n            },\n            parse_mode: \"HTML\"\n        }\n    };\n}\n\n// Ù…Ù‚Ø¯Ø§Ø± Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¯Ø± ØµÙˆØ±ØªÛŒ Ú©Ù‡ Ù…Ù‚Ø¯Ø§Ø± original Ø¯Ø± Ù„ÛŒØ³Øª Ù†Ø¨ÙˆØ¯\nreturn {\n    json: {\n        result: $json.result,\n        original: inputData\n    }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1080,
        600
      ],
      "id": "7e9b80d5-baec-4d45-b4b4-17922b82ea78",
      "name": "Make Menu Message3"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://api.telegram.org/bot{{ $('BOT INFO').item.json.TOKEN }}/SendMessage",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "chat_id",
              "value": "={{ $('SIMORGH').item.json.message.from.id }}"
            },
            {
              "name": "text",
              "value": "={{ $('Make Menu Message3').item.json.message }}"
            },
            {
              "name": "reply_markup",
              "value": "={{ $('Make Menu Message3').item.json.reply_markup }}"
            },
            {
              "name": "parse_mode",
              "value": "={{ $('Make Menu Message3').item.json.parse_mode }}"
            }
          ]
        },
        "options": {}
      },
      "id": "d23d4446-1371-46ae-972c-7f14919822fb",
      "name": "SEND result Click Menu Layer 3",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1260,
        600
      ]
    },
    {
      "parameters": {
        "jsCode": "// Ú¯Ø±ÙØªÙ† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø² Ù†ÙˆØ¯ BOT TOKEN\nconst botData = $('BOT INFO').item.json; // Ø®ÙˆØ§Ù†Ø¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù†ÙˆØ¯ BOT TOKEN\nconst botName = botData[\"bot-name\"] || \"Ù†Ø§Ù… Ø¨Ø§Øª ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡\"; // Ø¯Ø±ÛŒØ§ÙØª Ù†Ø§Ù… Ø¨Ø§Øª\nconst botsupport = botData[\"support-username\"] || \"Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ø¯Ø§Ø±Ø¯\"; // Ø¯Ø±ÛŒØ§ÙØª ÛŒÙˆØ²Ø±Ù†ÛŒÙ… Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ\n\n// Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙˆØ±ÙˆØ¯ÛŒ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† payload\nconst payload = $('SIMORGH').item.json;\nlet inputData;\n// ØªØ¹ÛŒÛŒÙ† Ù…Ù†Ø¨Ø¹ JSON: Ù¾ÛŒØ§Ù… ÛŒØ§ Ú©Ø§Ù„â€ŒØ¨Ú©\nif (payload.message) {\n    inputData = payload.message.from.id;\n} else if (payload.callback_query) {\n    inputData = payload.callback_query.from.id;\n} else {\n    inputData = null;\n}\n\n// ØªØ¹ÛŒÛŒÙ† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø¯Ù…ÛŒÙ† (Ø¨Ø±Ø§ÛŒ Ù†ÙˆØªÛŒÙØ§ÛŒ)\nlet adminUsername, adminUserId;\nif (payload.callback_query) {\n    adminUsername = payload.callback_query.from.username || payload.callback_query.from.id;\n    adminUserId = payload.callback_query.from.id;\n} else if (payload.message) {\n    adminUsername = payload.message.from.username || payload.message.from.id;\n    adminUserId = payload.message.from.id;\n} else {\n    adminUsername = \"Ù†Ø§Ù…Ø´Ø®Øµ\";\n    adminUserId = \"Ù†Ø§Ù…Ø´Ø®Øµ\";\n}\n\n// Ù„ÛŒØ³Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†\nconst users = [\n    {\"id\": 1, \"name\": \"Ø¹Ù„ÛŒ Ù…Ø¹Ù…Ø§Ø±\", \"user_id\": 97164371},\n    {\"id\": 2, \"name\": \"Ù…Ù‡Ø¯ÛŒ Ø­Ø³ÛŒÙ†ÛŒ\", \"user_id\": 83553051},\n    {\"id\": 3, \"name\": \"Ø­Ø³ÛŒÙ† Ø§Ù†Ú¯Ø§Ø´ØªÙ‡\", \"user_id\": 1939118028},\n    {\"id\": 4, \"name\": \"Ù‡Ø§Ù†ÛŒ Ø±Ø¶Ø§ÛŒÛŒ\", \"user_id\": 438311561},\n    {\"id\": 5, \"name\": \"ÛŒØ§Ø³ÛŒÙ† ÙˆÙ„ÛŒ\", \"user_id\": 84316833},\n    {\"id\": 6, \"name\": \"Ù…Ø­Ù…Ø¯Ø±Ø¶Ø§ Ù…Ø¹Ù…Ø§Ø±\", \"user_id\": 110549011},\n    {\"id\": 7, \"name\": \"Ø­Ø³ÛŒÙ† Ù‡Ø§Ø´Ù…ÛŒØ§Ù†\", \"user_id\": 110344197},\n    {\"id\": 8, \"name\": \"Ø¨Ù‡Ø²Ø§Ø¯ Ø§ØµÙÙ‡Ø§Ù†ÛŒ\", \"user_id\": 422626662},\n    {\"id\": 9, \"name\": \"Ù…Ø¬ÛŒØ¯ Ø¯Ù‡â€ŒÙ†Ù…Ú©ÛŒ\", \"user_id\": 274432130},\n    {\"id\": 10, \"name\": \"Ø¹Ù„ÛŒ Ø§Ø®Ø¨Ø§Ø±ÛŒ\", \"user_id\": 245149665},\n    {\"id\": 11, \"name\": \"Ø³Ø¹ÛŒØ¯ Ø§Ù…ÛŒØ¯ÛŒ\", \"user_id\": 222807547},\n    {\"id\": 12, \"name\": \"Ù…Ø­Ù…Ø¯ ØªÙ‚ÛŒ Ø²Ø§Ø¯Ù‡\", \"user_id\": 150800621},\n    {\"id\": 13, \"name\": \"Ù…ØµØ·ÙÛŒ Ø­Ø³ÛŒÙ†Ø®Ø§Ù†ÛŒ\", \"user_id\": 126164042},\n    {\"id\": 14, \"name\": \"Ø§Ù…ÛŒØ±Ø­Ø³ÛŒÙ† Ø¨Ø§Ù‚Ø±Ø²Ø§Ø¯Ù‡\", \"user_id\": 7699849418},\n    {\"id\": 15, \"name\": \"Ù…ØµØ·ÙÛŒ ÙØªØ­ÛŒ\", \"user_id\": 110702431},\n    {\"id\": 16, \"name\": \"Ø­Ø³ÛŒÙ† Ø¹Ù„ÛŒ Ø¹Ø³Ú¯Ø±ÛŒ\", \"user_id\": 283552388},\n    {\"id\": 17, \"name\": \"Ù…Ù‡Ø¯ÛŒ Ø³Ø¹ÛŒØ¯ÛŒ\", \"user_id\": 516218590},\n    {\"id\": 18, \"name\": \"Ù…Ø±ØªØ¶ÛŒ Ù¾ÙˆØ±Ø­Ø³ÛŒÙ†\", \"user_id\": 1423078300},\n    {\"id\": 19, \"name\": \"Ø±Ø­Ù…Ø§Ù† Ø´Ù…Ø³ÛŒ\", \"user_id\": 6987405825},\n    {\"id\": 20, \"name\": \"Ù…Ø­Ù…Ø¯Ø¬ÙˆØ§Ø¯ Ú©Ø±ÛŒÙ…ÛŒ\", \"user_id\": 7479456283},\n    {\"id\": 21, \"name\": \"Ù…Ø­Ù…Ø¯Ø±Ø¶Ø§ Ù…Ù‡Ø§Ø¬Ø±Ù†ÛŒØ§\", \"user_id\": 92903851},\n    {\"id\": 22, \"name\": \"Ø¢ÙˆØ§ Ù‚Ø§Ø³Ù…ÛŒ\", \"user_id\": 7415375623},\n    {\"id\": 23, \"name\": \"Ø¹Ù„ÛŒ Ù…Ø¹Ù…Ø§Ø±ÛŒ\", \"user_id\": 121713560},\n    {\"id\": 24, \"name\": \"Ù…ÛŒÙ„Ø§Ø¯ Ù†ÛŒÚ© Ø¢Ø²Ù…Ø§\", \"user_id\": 5616348466},\n    {\"id\": 26, \"name\": \"Ø³Ù¾Ù‡Ø± Ø´Ø¹Ø¨Ø§Ù†ÛŒ\", \"user_id\": 1816545723},\n    {\"id\": 27, \"name\": \"Ø§Ø­Ù…Ø¯ Ú©Ù…Ø§Ù„ÛŒ\", \"user_id\": 7091595139},\n    {\"id\": 28, \"name\": \"Ø¹Ù„ÛŒ Ù¾ÙˆØ± Ø¨Ù‡Ø±ÙˆØ²Ø§Ù†\", \"user_id\": 7868874927},\n    {\"id\": 29, \"name\": \"Ù…Ø¬ÛŒØ¯ ÙØ§Ø¶Ù„ÛŒ\", \"user_id\": 416031526},\n    {\"id\": 30, \"name\": \"Ø¹Ù„ÛŒ Ø¯Ù‡Ù‚Ø§Ù†ÛŒ\", \"user_id\": 1003089783},\n    {\"id\": 31, \"name\": \"Ø­Ø§Ù…Ø¯ Ù‚Ø±Ø¨Ø§Ù†ÛŒ\", \"user_id\": 191620139},\n    {\"id\": 33, \"name\": \"ÙØ±Ø²ÛŒÙ† Ù…Ø¬Ø¯\", \"user_id\": 6010489050},\n    {\"id\": 34, \"name\": \"Ø­Ø³ÛŒÙ† Ø¹Ø±Ø¨\", \"user_id\": 1737639707},\n    {\"id\": 35, \"name\": \"ÙØ§Ø·Ù…Ù‡ ÙØ±Ù…Ø§Ù† Ø²Ø§Ø¯Ù‡\", \"user_id\": 7560974272},\n    {\"id\": 36, \"name\": \"Ø±Ø¶Ø§ Ø®Ù„Ø¹ØªØ¨Ø±ÛŒ\", \"user_id\": 815221436},\n    {\"id\": 37, \"name\": \"Ù…ØµØ·ÙÛŒ Ø·Ø­Ø§Ù† Ù†Ú˜Ø§Ø¯\", \"user_id\": 1453634941},\n    {\"id\": 38, \"name\": \"Ø¹Ù„ÛŒ Ø§Ø­Ù…Ø¯ÛŒ\", \"user_id\": 97650917},\n    {\"id\": 39, \"name\": \"ØªÙˆØ­ÛŒØ¯ Ù„Ø·ÙÛŒ\", \"user_id\": 46059517},\n    {\"id\": 40, \"name\": \"Ù…Ø­Ø³Ù† Ø±Ø¬Ø¨ÛŒ\", \"user_id\": 185330596},\n    {\"id\": 41, \"name\": \"Ø­Ù…ÛŒØ¯ Ø´Ù‡Ø¨Ø§Ø±ÛŒ\", \"user_id\": 103743033},\n    {\"id\": 42, \"name\": \"Ø§Ù…ÛŒÙ† ÙØ§Ø·Ù…ÛŒ\", \"user_id\": 74979638},\n    {\"id\": 43, \"name\": \"Ù…Ø¬ØªØ¨ÛŒ Ø´Ø§Ù‚ÛŒ\", \"user_id\": 6693154859},\n    {\"id\": 44, \"name\": \"Ù¾ÙˆÛŒØ§ Ø±Ø­ÛŒÙ…ÛŒ\", \"user_id\": 7709912372},\n    {\"id\": 45, \"name\": \"Ø¹Ù„ÛŒ Ø®Ø§Ù†Ú†Ø±Ù„ÛŒ\", \"user_id\": 315867518},\n    {\"id\": 46, \"name\": \"Ø²Ù‡Ø±Ø§ Ù‡Ø§Ø´Ù… Ù¾ÙˆØ±\", \"user_id\": 180497899},\n    {\"id\": 47, \"name\": \"Ù…Ø­Ù…Ø¯Ø§Ù…ÛŒÙ† Ú†Ø±Ø§ØºÛŒØ§Ù†\", \"user_id\": 882730020},\n    {\"id\": 48, \"name\": \"Ù…Ø¬ÛŒØ¯ Ø³ÛŒÙÛŒ\", \"user_id\": 5734904638},\n    {\"id\": 49, \"name\": \"Ø§Ù…ÛŒÙ† Ù‡ÙˆØ§Ø³ÛŒ\", \"user_id\": 368739228},\n    {\"id\": 50, \"name\": \"Ù…Ø¬ÛŒØ¯ Ø³Ø¹ÛŒØ¯ÛŒ\", \"user_id\": 516218590},\n    {\"id\": 51, \"name\": \"ÙØ§Ø·Ù…Ù‡ Ø§Ø¬ÛŒÙ„ÛŒ\", \"user_id\": 106583524},\n    {\"id\": 52, \"name\": \"Ù…Ø­Ø³Ù† Ø´Ù…Ø³ÛŒ\", \"user_id\": 3470979539},\n    {\"id\": 54, \"name\": \"Ø³ÛŒÙ†Ø§\", \"user_id\": 135385832},\n    {\"id\": 55, \"name\": \"Ø¢Ø±Ø´ Ø³Ø§Ù„Ø§Ø±ÛŒ\", \"user_id\": 229038702},\n    {\"id\": 56, \"name\": \"Ø¢Ø±Ø´ Ø³Ø§Ù„Ø§Ø±ÛŒ\", \"user_id\": 229038702},\n    {\"id\": 57, \"name\": \"Ø§Ù…ÛŒÙ† Ø¯ÙˆÙ…\", \"user_id\": 7534724248},\n    {\"id\": 58, \"name\": \"Ø¢Ø±Ø´ Ù…Ù„Ú© ØªØ§Ø¬ÛŒ\", \"user_id\": 5124754671},\n    {\"id\": 59, \"name\": \"Ù…Ø­Ù…Ø¯ Ø¨Ù‡Ù…Ù†ÛŒØ§Ø±\", \"user_id\": 6741300396},\n    {\"id\": 61, \"name\": \"Ù…Ù‡Ø¯ÛŒ Ø§Ø¹ØªÙ…Ø§Ø¯ÛŒ\", \"user_id\": 1985282555},\n    {\"id\": 62, \"name\": \"Ù…Ø­Ø³Ù† Ú©Ù‡Ù†Ø¯Ø§Ù†ÛŒ\", \"user_id\": 135819842},\n    {\"id\": 63, \"name\": \"Ù…Ø­Ù…Ø¯Ø¬ÙˆØ§Ø¯ Ù…ÙˆØ³ÙˆÛŒ\", \"user_id\": 101250034},\n      {\"id\": 64, \"name\": \"Ø­Ø³Ø§Ù… Ù‚Ø¯ÛŒØ±ÛŒ\", \"user_id\": 6434872716},\n        {\"id\": 64, \"name\": \"Ù…ØµØ·ÙÛŒ Ø¹Ø³Ú©Ø±ÛŒ\", \"user_id\": 1132635555},\n   {\"id\": 64, \"name\": \"Ø­Ù…ÛŒØ¯Ø´Ù‡Ø¨Ø§Ø²ÛŒ\", \"user_id\": 5914461309},\n     {\"id\": 64, \"name\": \"Ù†ÙˆØ± Ø³Ø¬Ø§Ø¯ÛŒ\", \"user_id\": 7146836414},\n       {\"id\": 64, \"name\": \"Ø­Ø³ÛŒÙ† Ø²Ø±Ú¯Ø±\", \"user_id\": 192204657},\n         {\"id\": 64, \"name\": \"Ù…Ø­Ù…Ø¯ Ù„Ø§Ø¬ÙˆØ±Ø¯ÛŒ\", \"user_id\": 6316472362},\n     {\"id\": 64, \"name\": \"ÙØ§Ø·Ù…Ù‡ Ù†Ø§ØµØ±ÛŒ\", \"user_id\": 5090731432},\n       {\"id\": 64, \"name\": \"ÙØ§Ø·Ù…Ù‡ Ù†Ù…Ø§Ø²ÛŒØ§Ù†\", \"user_id\": 5725831272},\n           {\"id\": 64, \"name\": \"Ù…ÛŒÙ†Ø§ Ù…ÛŒØ±Ø¬Ù„ÛŒÙ„ÛŒ\", \"user_id\": 88094478},\n  {\"id\": 64, \"name\": \"Ù…Ù‡Ø¯ÛŒ ØºÙ„Ø§Ù…ÛŒ\", \"user_id\": 241885704},\n   {\"id\": 64, \"name\": \"Ù…Ø­Ù…Ø¯Ø±Ø¶Ø§ Ø¬Ù‡Ø§Ù†â€ŒÙ†Ù…Ø§\", \"user_id\": 410271064},\n  {\"id\": 64, \"name\": \"Ù…ÛŒØ«Ù… Ø­Ø³Ù†ÛŒ\", \"user_id\": 95238384},\n   {\"id\": 64, \"name\": \"Ø³Ù…ÛŒØ±Ø§ Ù…Ø­Ù…Ø¯Ø²Ø§Ø¯Ù‡\", \"user_id\": 5488361676}\n  ];\n\n// Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ú©Ø§Ø±Ø¨Ø±ÛŒ Ú©Ù‡ user_id Ø¨Ø±Ø§Ø¨Ø± Ø¨Ø§ Ù…Ù‚Ø¯Ø§Ø± inputData Ù‡Ø³Øª\nconst user = users.find(u => u.user_id === inputData);\n\n// Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ú©Ø§Ø±Ø¨Ø± ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ù‡ ÛŒØ§ Ù†Ù‡\nif (user) {\n    return {\n        json: {\n            ...user, // Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±\n            access: true // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† ÙÛŒÙ„Ø¯ access Ø¨Ø§ Ù…Ù‚Ø¯Ø§Ø± true\n        }\n    };\n}\n\n// ÙˆÙ‚ØªÛŒ Ú©Ø§Ø±Ø¨Ø± Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯ØŒ Ø¯Ùˆ Ù¾Ø§Ø³Ø® Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒØ´Ù‡ (Ù…Ø³ÛŒØ¬ Ø§ØµÙ„ÛŒ + notify-admin register)\nreturn {\n    json: {\n        // Ù…Ø³ÛŒØ¬ Ù‚Ø¨Ù„ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù„Ø§Ø¹ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±\n        message: `Ù…ØªØ§Ø³ÙØ§Ù†Ù‡ Ø´Ù…Ø§ Ø¨Ù‡ ${botName} Ø¯Ø³ØªØ±Ø³ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯. Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø³ØªØ±Ø³ÛŒØŒ Ù„Ø·ÙØ§ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù‡ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯.`,\n        reply_markup: {\n            inline_keyboard: [\n                [{ text: \"Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¯Ø³ØªØ±Ø³ÛŒ Ø§Ø² Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ\", url: `${botsupport}` }]\n            ]\n        },\n        parse_mode: \"HTML\",\n        access: false,\n        // Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† Ø§ÙˆÙ„ Ø¨Ø±Ø§ÛŒ Ø§Ø¯Ù…ÛŒÙ† (Ù‚Ø¨ÙˆÙ„/Ø±Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øª)\n        notify_admin: {\n            text: `ÛŒÚ© Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ Ù…Ø´Ø®ØµØ§Øª:\\nÙ†Ø§Ù…: ${adminUsername}\\nØ¢ÛŒØ¯ÛŒ: ${adminUserId}\\nØ±Ø¨Ø§Øª Ø±Ø§ Ø§Ø³ØªØ§Ø±Øª Ú©Ø±Ø¯Ù‡ Ú©Ù‡ Ø¹Ø¶Ùˆ Ù„ÛŒØ³Øª Ù†Ù…ÛŒâ€ŒØ¨Ø§Ø´Ø¯. Ú†Ù‡ ÙˆØ§Ú©Ù†Ø´ÛŒ Ù†Ø´Ø§Ù† Ù…ÛŒâ€ŒØ¯Ù‡ÛŒØ¯ØŸ`,\n            reply_markup: {\n                inline_keyboard: [\n                    [\n                        { text: \"Ù¾Ø°ÛŒØ±Ø´\", callback_data: \"notify-admin-accept:\" + adminUserId },\n                        { text: \"Ø±Ø¯\", callback_data: \"notify-admin-reject:\" + adminUserId }\n                    ]\n                ]\n            }\n        },\n        // Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† Ø¯ÙˆÙ… Ø¨Ø±Ø§ÛŒ Ø«Ø¨Øª Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ Ù‡Ø§ÛŒÙ¾Ø±Ù„ÛŒÙ†Ú© Ú©Ø±Ø¯Ù† Ø¢ÛŒØ¯ÛŒ\n        notify_admin_register: {\n            text: `Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø´Ø¯!\\nÚ©Ø§Ø±Ø¨Ø±ÛŒ Ø¨Ø§ Ø¢ÛŒØ¯ÛŒ <a href=\"https://telegram.me/${adminUsername}\">${adminUserId}</a> ÙˆØ§Ø±Ø¯ Ø±Ø¨Ø§Øª Ø´Ø¯Ù‡ Ø§Ø³Øª Ú©Ù‡ Ø¯Ø± Ù„ÛŒØ³Øª Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.\\nØ¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§ÛŒÙ† Ú©Ø§Ø±Ø¨Ø± Ø±Ø§ Ø«Ø¨Øª Ú©Ù†ÛŒØ¯ØŸ`,\n            reply_markup: {\n                inline_keyboard: [\n                    [\n                      { text: \"Ø±Ø¯\", callback_data: \"notify-admin-reject:\" + adminUserId },\n                        { text: \"Ø«Ø¨Øª Ú©Ø§Ø±Ø¨Ø±\", callback_data: \"notify-admin-register:\" + adminUserId }\n                    ]\n                ]\n            }\n        }\n    }\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -260,
        320
      ],
      "id": "376ada55-24f3-4bac-9d5f-26d7e2a7d366",
      "name": "Check User Exist List"
    },
    {
      "parameters": {
        "content": "## Ø¢Ù¾Ø¯ÛŒØª Ø´ÙˆØ¯\nØ¨Ø§ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù† Ù‡Ø± ÛŒÙˆØ²Ø± Ø§ÛŒÙ† Ø¨Ø§ÛŒØ¯ Ø¢Ù¾Ø¯ÛŒØª Ø¨Ø´Ù‡",
        "width": 190,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -320,
        220
      ],
      "typeVersion": 1,
      "id": "27dcc968-325d-4d7d-92d6-026b23a67b96",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "c6e90657-95f5-4145-99f1-26f6aed6da16",
              "leftValue": "={{ $json.access }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -80,
        320
      ],
      "id": "87a3a189-a7fb-4aa6-b464-84e3a8b30c05",
      "name": "IF EXIST True"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://api.telegram.org/bot{{ $('BOT INFO').item.json.TOKEN }}/SendMessage",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "chat_id",
              "value": "={{ $('SIMORGH').item.json.message?.from?.id || $('SIMORGH').item.json.callback_query?.from?.id || 'False' }}"
            },
            {
              "name": "text",
              "value": "={{ $json.message }}"
            },
            {
              "name": "reply_markup",
              "value": "={{ $json.reply_markup }}"
            },
            {
              "name": "parse_mode",
              "value": "={{ $json.parse_mode }}"
            }
          ]
        },
        "options": {}
      },
      "id": "ab0fd16c-9ddd-4ffa-a5d5-e8420242b8ab",
      "name": "SEND Reject Message To-User",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -40,
        580
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://api.telegram.org/bot{{ $('BOT INFO').item.json.TOKEN }}/SendMessage",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "chat_id",
              "value": "={{ $('BOT INFO').item.json['admin-username'] }}"
            },
            {
              "name": "=text",
              "value": "={{ $('IF EXIST True').item.json.notify_admin_register.text }}"
            },
            {
              "name": "=reply_markup",
              "value": "={{ $('IF EXIST True').item.json.notify_admin_register.reply_markup }}"
            },
            {
              "name": "parse_mode",
              "value": "={{ $('Check User Exist List').item.json.parse_mode }}"
            }
          ]
        },
        "options": {}
      },
      "id": "f5a4a72d-a330-4959-aaa2-83a5a1515fdb",
      "name": "Notify admin",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        160,
        580
      ]
    },
    {
      "parameters": {
        "jsCode": "// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯\nconst botData = $('BOT INFO').item.json; // Ø®ÙˆØ§Ù†Ø¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù†ÙˆØ¯ BOT TOKEN\nconst bottoken = botData[\"TOKEN\"] || \"ØªØ¹ÛŒÛŒÙ† Ù†Ø´Ø¯Ù‡\"; // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù…Ù‚Ø¯Ø§Ø± ØªÙˆÚ©Ù† Ø¨Ø§Øª\nconst botName = botData[\"bot-name\"] || \"Ù†Ø§Ù… Ø¨Ø§Øª ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡\";\nconst chat = botData[\"support-username\"];\nconst botsupport = botData[\"support-username\"] || \"Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ø¯Ø§Ø±Ø¯\";\nconst chatuserid = botData[\"ch-username\"] || \"ÛŒÙˆØ²Ø¢ÛŒØ¯ÛŒ Ú†Ù†Ù„ ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡\";\n\n// Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± (Ø¨Ø±Ø§ÛŒ chat_id)\nconst userData = $item(\"0\").$node[\"SIMORGH\"].json[\"callback_query\"]?.message?.chat.id ||\n                 $item(\"0\").$node[\"SIMORGH\"].json[\"message\"]?.chat.id;\n\n// Ø¯Ø±ÛŒØ§ÙØª Ù…Ù‚Ø¯Ø§Ø± Ùˆ Ø³Ø§ÛŒØ± ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ ÙˆØ±ÙˆØ¯ÛŒ Ø§Ø² Ù†ÙˆØ¯ Ù‚Ø¨Ù„ÛŒ\nconst jsonData = $('Merge Switcher text').item.json; // Ø´Ø§Ù…Ù„ result, reply_text, original, ...\n// ØªØºÛŒÛŒØ± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¨Ù‡ reply_text\nconst inputText = jsonData.reply_text;\n\nif(jsonData.result === \"Confirm\") {\n    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ù‡Ø¯Ù (touser_name) Ø§Ø² reply_text\n    const touser_name_match = inputText.match(/Ø´Ù…Ø§\\s+Ù…ÛŒØ®ÙˆØ§ÛŒ\\s+Ø¨Ù‡\\s+(.*?)ØŒ/);\n    const touser_name = touser_name_match ? touser_name_match[1] : \"Ù†Ø§Ù… Ù†Ø§Ù…Ø´Ø®Øµ\";\n    \n    // Ú¯Ø±ÙØªÙ† Ø¯Ù„ÛŒÙ„ (reason) Ø§Ø² Ù…ØªÙ† Ù¾ÛŒØ§Ù… SIMORGH\n    const reason = $('SIMORGH').item.json.message.text;\n    \n    // ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ú¯Ø±ÙØªÙ† reply_markup Ø§Ø² reply_to_message ÛŒØ§ message.reply_to_message Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† fallback\n    let replyMarkup = $('SIMORGH').item.json.reply_to_message?.reply_markup ||\n                      $('SIMORGH').item.json.message?.reply_to_message?.reply_markup;\n    if (!replyMarkup || !replyMarkup.inline_keyboard || !replyMarkup.inline_keyboard[0] || !replyMarkup.inline_keyboard[0][0]) {\n        throw new Error(\"Missing inline_keyboard data in reply_to_message\");\n    }\n    const callbackData = replyMarkup.inline_keyboard[0][0].callback_data;\n    const parts = callbackData.split('^');\n    const touser_id = parts[1];\n    const amount = parts[2];\n    \n    // Ø³Ø§Ø®Øª Ù…ØªÙ† Ù¾ÛŒØ§Ù… Ø¬Ø¯ÛŒØ¯\n    const messageText = `Ø´Ù…Ø§ Ù‚ØµØ¯ Ø¯Ø§Ø±ÛŒØ¯ Ø¨Ù‡ ${touser_name} ${amount} Ø§Ù…ØªÛŒØ§Ø² Ø¨Ø¯Ù‡ÛŒØ¯.\\n\\n---------------------------------\\nØ¯Ù„ÛŒÙ„ :â€Œ ${reason}\\n---------------------------------\\n\\nØ§Ú¯Ø± Ù…ØªÙ† Ù…Ù†Ø§Ø³Ø¨ Ø§Ø³ØªØŒ Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ Â«ØªØ§ÛŒÛŒØ¯Â» Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ ØªØ§ Ø§Ù…ØªÛŒØ§Ø² Ø«Ø¨Øª Ø´ÙˆØ¯.\\nØ¯Ø± ØºÛŒØ± Ø§ÛŒÙ† ØµÙˆØ±ØªØŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ù†ÛŒØ¯.`;\n    \n    // Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø´ÛŒØ´Ù‡â€ŒØ§ÛŒ Ø¬Ø¯ÛŒØ¯\n    const inline_keyboard = [\n       [\n         { text: \"âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´\", callback_data: `tovote^${touser_id}^${amount}` },\n         { text: \"âœ… ØªØ§ÛŒÛŒØ¯\", callback_data: `Confirm^${touser_id}^${amount}` }\n\n         ],\n         [{ text: \"âŒ Ø§Ù†ØµØ±Ø§Ù\", callback_data: `Cancel^${touser_id}^${amount}` }]\n       \n    ];\n    \n    return {\n        url: `https://api.telegram.org/bot${bottoken}/editMessageText`,\n        method: \"POST\",\n        parameters: {\n            // ØªØºÛŒÛŒØ±: Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù…Ù‚Ø¯Ø§Ø± Ø«Ø§Ø¨Øª Ø¨Ø±Ø§ÛŒ message_id\n            message_id: $('SIMORGH').item.json.message.reply_to_message.message_id,\n            chat_id: userData,\n            text: messageText,\n            parse_mode: \"HTML\",\n            reply_markup: { inline_keyboard }\n        }\n    };\n}\n\n// ØªØ¹Ø±ÛŒÙ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ Ùˆ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ù‡Ø± Ù…Ù‚Ø¯Ø§Ø± original\nconst responses = {\n    \"/tools\": {\n        message: `Ú©Ø§Ø±Ø¨Ø± Ú¯Ø±Ø§Ù…ÛŒ\\nÙ„Ø·ÙØ§ ÛŒÚ©ÛŒ Ø§Ø² Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ø±Ùˆ Ø¨Ø±Ø§ÛŒ ${botName} Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ :`,\n        buttons: [\n            [{ text: \"Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ø§ÛŒÙ‡ ğŸ¦µ\", callback_data: \"baseinfo^\" }],\n            [{ text: \"ØªØ§Ø±ÛŒØ®Ú†Ù‡ \", callback_data: \"historytools^\" }],\n            [\n                { text: \"Â» Ø±Ø§Ù‡Ù†Ù…Ø§\", callback_data: \"helptools^\" },\n                { text: \"Â» Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ\", url: `${botsupport}` }\n            ]\n        ]\n    }\n};\n// Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ù…Ù‚Ø¯Ø§Ø± original Ø¯Ø± Ù„ÛŒØ³Øª Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ù…Ø§ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯ ÛŒØ§ Ù†Ù‡\nif (responses[jsonData.original]) {\n    const response = responses[jsonData.original];\n    return {\n        url: `https://api.telegram.org/bot${bottoken}/editMessageText`,\n        method: \"POST\",\n        parameters: {\n            message_id: $('SIMORGH').item.json.reply_to_message.message.message_id,\n            chat_id: userData, // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² chat_id Ø¬Ø¯ÛŒØ¯\n            text: response.message,\n            parse_mode: \"HTML\",\n            reply_markup: {\n                inline_keyboard: response.buttons\n            }\n        }\n    };\n}\n\n// Ù…Ù‚Ø¯Ø§Ø± Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¯Ø± ØµÙˆØ±ØªÛŒ Ú©Ù‡ Ù…Ù‚Ø¯Ø§Ø± original Ø¯Ø± Ù„ÛŒØ³Øª Ù†Ø¨ÙˆØ¯\nreturn {\n    url: `https://api.telegram.org/bot${bottoken}/editMessageText`,\n    method: \"POST\",\n    parameters: {\n        message_id: $('SIMORGH').item.json.message.reply_to_message.message_id,\n        chat_id: userData, // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² chat_id Ø¬Ø¯ÛŒØ¯\n        text: `${$json.result}\\noriginal: ${jsonData.original}`,\n        parse_mode: \"HTML\"\n    }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        880,
        880
      ],
      "id": "a5088057-9391-46cd-b0e9-4a27ed109273",
      "name": "Confirm_Make_Menu_Message"
    },
    {
      "parameters": {
        "method": "={{ $json.method }}",
        "url": "={{ $json.url }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $json.parameters }}",
        "options": {}
      },
      "id": "db5e3071-f223-441f-9ab8-113bebbc1b7c",
      "name": "SEND result Click Menu Layer 4",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1080,
        880
      ]
    },
    {
      "parameters": {
        "operation": "deleteMessage",
        "chatId": "={{ $('SIMORGH').item.json.message.from.id }}",
        "messageId": "={{ $('SIMORGH').item.json.message.message_id }}"
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1100,
        1100
      ],
      "id": "b90fedd2-2c34-4e2a-9441-cd8c5a0e756f",
      "name": "Telegram",
      "webhookId": "3d1f839b-75da-432b-bf81-f3f7e079899e",
      "credentials": {
        "telegramApi": {
          "id": "UWUpTV3J983xhaJy",
          "name": "SIMORGH"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "ee9719f6-8546-45a1-8ab0-2561c9b717f0",
              "leftValue": "={{ $('Request-to-db').item.json.Insufficientcredit }}",
              "rightValue": "false",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1940,
        -20
      ],
      "id": "c0013258-6024-42b9-b1f1-174769a90628",
      "name": "If1"
    },
    {
      "parameters": {
        "chatId": "={{ $('BOT INFO').item.json['ch-username'] }}",
        "text": "={{ $('Check User Exist List').item.json.name }} {{ $('Request-to-db').item.json.amount }} Ø§Ù…ØªÛŒØ§Ø² Ø¨Ù‡ {{ $('Request-to-db').item.json.touser_name }} Ø¯Ø§Ø¯ Ùˆ Ù†ÙˆØ´Øª : \n\nğŸ’¬ {{ $('Request-to-db').item.json.reason }}\n\nâ° {{ (function(){\n    const d = new Date();\n    return [\n        d.toLocaleDateString(\"fa-IR\", { weekday: 'long' }),\n        d.toLocaleDateString(\"fa-IR\", { day: 'numeric' }),\n        d.toLocaleDateString(\"fa-IR\", { month: 'long' }),\n        d.toLocaleDateString(\"fa-IR\", { year: 'numeric' })\n    ].join(' ');\n})() }}\n",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2000,
        -220
      ],
      "id": "40806f84-8686-4b67-b760-eee12fbe8182",
      "name": "Send To Ch",
      "webhookId": "73a5332d-153a-43d0-82cb-dcabc5595f6d",
      "credentials": {
        "telegramApi": {
          "id": "UWUpTV3J983xhaJy",
          "name": "SIMORGH"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Request-to-db').item.json.touser }}",
        "text": "=ğŸ‰ {{ $('Check User Exist List').item.json.name }} {{ $('Request-to-db').item.json.amount }} Ø§Ù…ØªÛŒØ§Ø² Ø¨Ù‡Øª Ø¯Ø§Ø¯ Ùˆ Ù†ÙˆØ´Øª : \n\nğŸ’¬ {{ $('Request-to-db').item.json.reason }}\n\nâ° {{ (function(){\n    const d = new Date();\n    return [\n        d.toLocaleDateString(\"fa-IR\", { weekday: 'long' }),\n        d.toLocaleDateString(\"fa-IR\", { day: 'numeric' }),\n        d.toLocaleDateString(\"fa-IR\", { month: 'long' }),\n        d.toLocaleDateString(\"fa-IR\", { year: 'numeric' })\n    ].join(' ');\n})() }}\n",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Â» Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¯Ø± Ú©Ø§Ù†Ø§Ù„ğŸ‘",
                    "additionalFields": {
                      "url": "=https://t.me/c/{{ String($('Send To Ch').item.json.result.sender_chat.id).replace(\"-100\", \"\") }}/{{ $json.message_id }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2340,
        -220
      ],
      "id": "0eabdf32-511b-4f22-87da-f53f3cdae1e1",
      "name": "Send To User",
      "webhookId": "06c0cf00-5c69-4eb3-98e5-39749fbe2363",
      "credentials": {
        "telegramApi": {
          "id": "UWUpTV3J983xhaJy",
          "name": "SIMORGH"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "-- Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…Ù‚Ø¯Ø§Ø± message_id\nUPDATE transactions \nSET message_id = {{ $('Send To Ch').item.json.result.message_id }}\nWHERE transaction_id = {{ $('Request-to-db').item.json.transaction_id }};\n\n-- Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø±Ø¯ÛŒÙ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯Ù‡\nSELECT * \nFROM transactions \nWHERE transaction_id = {{ $('Request-to-db').item.json.transaction_id }};",
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        2160,
        -220
      ],
      "id": "fd585436-b85f-4dd5-8bdc-4d0360c64d2a",
      "name": "INSERT Message id",
      "credentials": {
        "mySql": {
          "id": "pZDfMlNbrmUUGmXF",
          "name": "Simorgh"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "WITH random_user AS (\n    SELECT touser \n    FROM transactions \n    ORDER BY RAND() \n    LIMIT 1\n)\nSELECT t.touser, t.reason, t.amount\nFROM transactions t\nJOIN users u ON t.touser = u.user_id\nWHERE t.touser = (SELECT touser FROM random_user);\n",
        "options": {
          "detailedOutput": true
        }
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        -480,
        920
      ],
      "id": "a9122d14-d786-46a7-904b-8c9faadeeba7",
      "name": "User info",
      "credentials": {
        "mySql": {
          "id": "pZDfMlNbrmUUGmXF",
          "name": "Simorgh"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Ú¯Ø±ÙØªÙ† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø§Ø² Ù†ÙˆØ¯ Ù‚Ø¨Ù„ÛŒ\nconst inputData = items[0].json.data;  // Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø§Ø² Ù‚Ø³Ù…Øª \"data\" Ø¯Ø± ÙˆØ±ÙˆØ¯ÛŒ Ú¯Ø±ÙØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯\n\n// Ù…ØªØºÛŒØ± Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø¬Ù…Ø¹ amount Ù‡Ø§ Ùˆ ØªØ±Ú©ÛŒØ¨ reason Ù‡Ø§\nlet totalAmount = 0;\nlet combinedReasons = \"\";\nconst seenReasons = new Map();  // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Map Ø¨Ø±Ø§ÛŒ Ú¯Ø±ÙˆÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ùˆ Ø¬Ù…Ø¹ amount Ù‡Ø§\n\n// Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§\ninputData.forEach((item, index) => {\n  // Ø§Ú¯Ø± reason Ù‚Ø¨Ù„Ø§Ù‹ Ø¯ÛŒØ¯Ù‡ Ù†Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯\n  if (!seenReasons.has(item.reason)) {\n    seenReasons.set(item.reason, 0);  // Ù…Ù‚Ø¯Ø§Ø± Ø§ÙˆÙ„ÛŒÙ‡ amount Ø±Ø§ ØµÙØ± Ù…ÛŒâ€ŒÚ¯Ø°Ø§Ø±ÛŒÙ…\n  }\n  // Ø¬Ù…Ø¹ Ú©Ø±Ø¯Ù† amount Ù‡Ø§ Ø¨Ø±Ø§ÛŒ Ù‡Ø± reason\n  seenReasons.set(item.reason, seenReasons.get(item.reason) + item.amount);\n});\n\n// ØªØ±Ú©ÛŒØ¨ reasons Ùˆ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø¬Ù…ÙˆØ¹ amount Ù‡Ø§\nseenReasons.forEach((amount, reason) => {\n  if (combinedReasons.length > 0) {\n    combinedReasons += \"\\n\";  // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø®Ø· Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø¬Ø¯Ø§ Ú©Ø±Ø¯Ù† reasons\n  }\n  combinedReasons += `${reason}`;  // Ø§ÙØ²ÙˆØ¯Ù† reason\n  totalAmount += amount;  // Ø¬Ù…Ø¹ Ú©Ø±Ø¯Ù† amount Ù‡Ø§\n});\n\n// Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†Ø¯Ù† Ù†ØªÛŒØ¬Ù‡\nreturn [{\n  json: {\n    reason: combinedReasons,\n    amount: totalAmount\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -280,
        920
      ],
      "id": "e95609e2-6ab3-49b0-91a7-d6723f76990d",
      "name": "Code",
      "disabled": true
    },
    {
      "parameters": {
        "chatId": "-1002496400244",
        "text": "={{ $json.message.content }}\n\nâ° {{ (function(){\n    const d = new Date();\n    return [\n        d.toLocaleDateString(\"fa-IR\", { weekday: 'long' }),\n        d.toLocaleDateString(\"fa-IR\", { day: 'numeric' }),\n        d.toLocaleDateString(\"fa-IR\", { month: 'long' }),\n        d.toLocaleDateString(\"fa-IR\", { year: 'numeric' })\n    ].join(' ');\n})() }} | #Ai",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": " ğŸ¯ Ø§Ù…ØªÛŒØ§Ø² Ø¯Ø§Ø¯Ù† Ø¯Ø± Ø±Ø¨Ø§Øª",
                    "additionalFields": {
                      "url": "=https://t.me/Simorgh34000bot?start=start"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        220,
        920
      ],
      "id": "28da12d2-7312-45e7-94cd-87cf2d47bb8f",
      "name": "Send To Ch1",
      "webhookId": "89c310cb-74bb-4b5e-ae5e-25adc0d8a22a",
      "credentials": {
        "telegramApi": {
          "id": "UWUpTV3J983xhaJy",
          "name": "SIMORGH"
        }
      }
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "hours",
              "hoursInterval": 12
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        -660,
        920
      ],
      "id": "f49dcc3e-2a82-4d32-9807-dc7019656701",
      "name": "Schedule Trigger",
      "disabled": true
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-4o",
          "mode": "list",
          "cachedResultName": "GPT-4O"
        },
        "messages": {
          "values": [
            {
              "content": "=ØªÙˆ Ù†Ù‚Ø´ ÛŒÙ‡ Ú¯Ø²Ø§Ø±Ø´Ú¯Ø± Ø¨Ø§Ø­Ø§Ù„ Ùˆ Ø´ÙˆØ® Ø±Ùˆ Ø¯Ø§Ø±ÛŒ.\nÛŒÙ‡ Ø¯ÛŒØªØ§ Ø¨Ù‡Øª Ù…ÛŒØ¯Ù… Ú©Ù‡ Ø´Ø§Ù…Ù„ Ø§ÛŒÙ† Ø¯ÙˆØªØ§Ø³Øª:\n\nreason: Ù…ØªÙ† ØªØ´Ú©Ø± Ø¨Ú†Ù‡â€ŒÙ‡Ø§ Ø§Ø² ÛŒÙ‡ Ù†ÙØ± Ú©Ù‡ Ø¨Ø§ Ø¹Ø¯Ø¯Ú¯Ø°Ø§Ø±ÛŒ (Ù…Ø«Ù„ 1-ØŒ 2-ØŒ ...) Ø¬Ø¯Ø§ Ø´Ø¯Ù‡.\n\namount: Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù…ØªÛŒØ§Ø²Ù‡Ø§ÛŒÛŒ Ú©Ù‡ Ø§ÙˆÙ† ÙØ±Ø¯ Ú¯Ø±ÙØªÙ‡.\n\nÚ©Ø§Ø±Øª Ø§ÛŒÙ†Ù‡ Ú©Ù‡ Ø¨Ø±Ø§Ø³Ø§Ø³ Ø§ÛŒÙ† Ø¯ÛŒØªØ§ ÛŒÙ‡ Ù…ØªÙ† Ø®ÛŒÙ„ÛŒ Ú©ÙˆØªØ§Ù‡ Ùˆ Ø®ÙˆØ¯Ù…ÙˆÙ†ÛŒ Ù…Ø«Ù„ ÛŒÙ‡ ØªÙˆÛŒÛŒØª Ø¨Ù†ÙˆÛŒØ³ÛŒ.\nØªÙˆÛŒ Ù…ØªÙ† Ø¨Ø§ÛŒØ¯:\n\nØ¨Ø§ Ù„Ø­Ù† Ù…Ø­Ø§ÙˆØ±Ù‡â€ŒØ§ÛŒ Ùˆ Ø¯ÙˆØ³ØªØ§Ù†Ù‡ Ù†Ø¸Ø± Ø¨Ú†Ù‡â€ŒÙ‡Ø§ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø§ÙˆÙ† ÙØ±Ø¯ Ø±Ùˆ Ø¨Ú¯ÛŒ.\n\nØ§Ø³Ù… Ø§ÙˆÙ† ÙØ±Ø¯ Ø±Ùˆ Ø§Ø² Ø¯Ø§Ø®Ù„ reason Ù¾ÛŒØ¯Ø§ Ú©Ù† Ùˆ ØªÙˆ Ù…ØªÙ† Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†.\n\nÙ…Ø¬Ù…ÙˆØ¹ Ø§Ù…ØªÛŒØ§Ø² (amount) Ø±Ùˆ Ù‡Ù… Ø¨Ú¯ÛŒ.\n\nØ´ÙˆØ®â€ŒØ·Ø¨Ø¹ Ø¨Ø§Ø´ÛŒ Ùˆ ÛŒÙ‡ Ø°Ø±Ù‡ Ø´ÛŒØ·Ù†Øª Ú©Ù†ÛŒ.\n\nØ­ÙˆØ§Ø³Øª Ø¨Ø§Ø´Ù‡:\n\nÙÙ‚Ø· Ù‡Ù…ÙˆÙ† ÛŒÙ‡ Ù…ØªÙ† Ø±Ùˆ Ø¨Ù†ÙˆÛŒØ³ØŒ Ù‡ÛŒÚ† ØªÙˆØ¶ÛŒØ­ Ø§Ø¶Ø§ÙÙ‡â€ŒØ§ÛŒ Ù†Ø¯Ù‡.\n\nØ·ÙˆÙ„ Ù…ØªÙ† Ú©Ù… Ø¨Ø§Ø´Ù‡ (Ø¯Ø± Ø­Ø¯ ÛŒÙ‡ ØªÙˆÛŒÛŒØª).\n\nØ¯ÛŒØªØ§:\nreason: {{ $json.reason }}\namount: {{ $json.amount }}\n\n",
              "role": "system"
            }
          ]
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        -120,
        920
      ],
      "id": "c2321199-41c9-4d74-82d9-802428e4fb2d",
      "name": "OpenAI",
      "credentials": {
        "openAiApi": {
          "id": "ogxmL5A0OV0Qe8np",
          "name": "Naderi"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('User info').item.json.data[0].touser }}",
        "text": "=Ù†Ú¯Ø§Ù‡ÛŒ Ø¨Ù†Ø¯Ø§Ø² Ø¨Ù‡ Ø®Ù„Ø§ØµÙ‡â€ŒÛŒ Ù†Ø¸Ø±Ø§Øª Ø¨Ú†Ù‡â€ŒÙ‡Ø§ Ø¯Ø±Ø¨Ø§Ø±Ù‡â€ŒÛŒ ØªÙˆ Ú©Ù‡ Ø¨Ø§ Ú©Ù…Ú© Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø¢Ù…Ø§Ø¯Ù‡ Ø´Ø¯Ù‡! ğŸ¤–âœ¨\nÙ¾ÛŒØ§Ù… Ú©Ø§Ù…Ù„ Ø¯Ø§Ø®Ù„ Ú©Ø§Ù†Ø§Ù„Ù‡! ğŸ‘‡ğŸ»ğŸ‘€\n\nâ° {{ (function(){\n    const d = new Date();\n    return [\n        d.toLocaleDateString(\"fa-IR\", { weekday: 'long' }),\n        d.toLocaleDateString(\"fa-IR\", { day: 'numeric' }),\n        d.toLocaleDateString(\"fa-IR\", { month: 'long' }),\n        d.toLocaleDateString(\"fa-IR\", { year: 'numeric' })\n    ].join(' ');\n})() }} | #Ai",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¯Ø± Ú©Ø§Ù†Ø§Ù„ ğŸ‘€",
                    "additionalFields": {
                      "url": "=https://t.me/c/2496400244/{{ $json.result.message_id }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        440,
        920
      ],
      "id": "4b9cc52d-0e77-43f0-9516-ff6f616a8394",
      "name": "Send Message To user",
      "webhookId": "89c310cb-74bb-4b5e-ae5e-25adc0d8a22a",
      "credentials": {
        "telegramApi": {
          "id": "UWUpTV3J983xhaJy",
          "name": "SIMORGH"
        }
      }
    }
  ],
  "pinData": {
    "Schedule Trigger": [
      {
        "json": {
          "timestamp": "2025-04-26T12:04:32.540+03:30",
          "Readable date": "April 26th 2025, 12:04:32 pm",
          "Readable time": "12:04:32 pm",
          "Day of week": "Saturday",
          "Year": "2025",
          "Month": "April",
          "Day of month": "26",
          "Hour": "12",
          "Minute": "04",
          "Second": "32",
          "Timezone": "Asia/Tehran (UTC+03:30)"
        }
      }
    ],
    "SIMORGH": [
      {
        "json": {
          "update_id": 601152980,
          "callback_query": {
            "id": "6112074759938131931",
            "from": {
              "id": 1423078300,
              "is_bot": false,
              "first_name": "Ù…Ø±ØªØ¶ÛŒ",
              "last_name": "Ù¾ÙˆØ±Ø­Ø³ÛŒÙ†",
              "username": "Simorghsupport_Pourhossein",
              "language_code": "en"
            },
            "message": {
              "message_id": 2867,
              "from": {
                "id": 8154200439,
                "is_bot": true,
                "first_name": "Ø±Ø¨Ø§Øª Ø³ÛŒÙ…Ø±Øº Û³Û´Û°Û°Û°",
                "username": "Simorgh34000bot"
              },
              "chat": {
                "id": 1423078300,
                "first_name": "Ù…Ø±ØªØ¶ÛŒ",
                "last_name": "Ù¾ÙˆØ±Ø­Ø³ÛŒÙ†",
                "username": "Simorghsupport_Pourhossein",
                "type": "private"
              },
              "date": 1745865434,
              "edit_date": 1745997038,
              "text": "#Ø²Ù…Ø³ØªØ§Ù†_1403\n\nØªÙˆ 100 Ø§Ù…ØªÛŒØ§Ø² Ø¯Ø§Ø±ÛŒ Ú©Ù‡ Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ Ø¨Ù‡ Ø¯ÙˆØ³ØªØ§Øª Ø¨Ø¯ÛŒ ğŸ\n\nØ§Ø² Ø¨ÛŒÙ† Ø§ÙØ±Ø§Ø¯ Ø²ÛŒØ±ØŒ Ø¨Ù‡ Ú©ÛŒ Ù…ÛŒâ€ŒØ®ÙˆØ§ÛŒ Ø§Ù…ØªÛŒØ§Ø² Ø¨Ø¯ÛŒØŸ ğŸ¤”",
              "entities": [
                {
                  "offset": 0,
                  "length": 12,
                  "type": "hashtag"
                }
              ],
              "reply_markup": {
                "inline_keyboard": [
                  [
                    {
                      "text": "1- Ø¹Ù„ÛŒ Ù…Ø¹Ù…Ø§Ø±",
                      "callback_data": "tovote^97164371"
                    },
                    {
                      "text": "2- Ù…Ù‡Ø¯ÛŒ Ø­Ø³ÛŒÙ†ÛŒ",
                      "callback_data": "tovote^83553051"
                    }
                  ],
                  [
                    {
                      "text": "3- Ø­Ø³ÛŒÙ† Ø§Ù†Ú¯Ø§Ø´ØªÙ‡",
                      "callback_data": "tovote^1939118028"
                    },
                    {
                      "text": "4- Ù‡Ø§Ù†ÛŒ Ø±Ø¶Ø§ÛŒÛŒ",
                      "callback_data": "tovote^438311561"
                    }
                  ],
                  [
                    {
                      "text": "5- ÛŒØ§Ø³ÛŒÙ† ÙˆÙ„ÛŒ",
                      "callback_data": "tovote^84316833"
                    },
                    {
                      "text": "6- Ù…Ø­Ù…Ø¯Ø±Ø¶Ø§ Ù…Ø¹Ù…Ø§Ø±",
                      "callback_data": "tovote^110549011"
                    }
                  ],
                  [
                    {
                      "text": "7- Ø­Ø³ÛŒÙ† Ù‡Ø§Ø´Ù…ÛŒØ§Ù†",
                      "callback_data": "tovote^110344197"
                    },
                    {
                      "text": "8- Ø¨Ù‡Ø²Ø§Ø¯ Ø§ØµÙÙ‡Ø§Ù†ÛŒ",
                      "callback_data": "tovote^422626662"
                    }
                  ],
                  [
                    {
                      "text": "9- Ù…Ø¬ÛŒØ¯ Ø¯Ù‡ Ù†Ù…Ú©ÛŒ",
                      "callback_data": "tovote^274432130"
                    },
                    {
                      "text": "10- Ø¹Ù„ÛŒ  Ø§Ø®Ø¨Ø§Ø±ÛŒ",
                      "callback_data": "tovote^245149665"
                    }
                  ],
                  [
                    {
                      "text": "11- Ø³Ø¹ÛŒØ¯ Ø§Ù…ÛŒØ¯ÛŒ",
                      "callback_data": "tovote^222807547"
                    },
                    {
                      "text": "12- Ù…Ø­Ù…Ø¯ ØªÙ‚ÛŒ Ø²Ø§Ø¯Ù‡",
                      "callback_data": "tovote^150800621"
                    }
                  ],
                  [
                    {
                      "text": "13- Ù…ØµØ·ÙÛŒ Ø­Ø³ÛŒÙ†Ø®Ø§Ù†ÛŒ",
                      "callback_data": "tovote^126164042"
                    },
                    {
                      "text": "14- Ø§Ù…ÛŒØ±Ø­Ø³ÛŒÙ† Ø¨Ø§Ù‚Ø±Ø²Ø§Ø¯Ù‡",
                      "callback_data": "tovote^7699849418"
                    }
                  ],
                  [
                    {
                      "text": "15- Ù…ØµØ·ÙÛŒ ÙØªØ­ÛŒ",
                      "callback_data": "tovote^110702431"
                    },
                    {
                      "text": "16- Ø­Ø³ÛŒÙ† Ø¹Ù„ÛŒ Ø¹Ø³Ú¯Ø±ÛŒ",
                      "callback_data": "tovote^283552388"
                    }
                  ],
                  [
                    {
                      "text": "17- Ù…Ù‡Ø¯ÛŒ Ø³Ø¹ÛŒØ¯ÛŒ",
                      "callback_data": "tovote^516218590"
                    },
                    {
                      "text": "18- Ù…Ø±ØªØ¶ÛŒ Ù¾ÙˆØ±Ø­Ø³ÛŒÙ†",
                      "callback_data": "tovote^1311414"
                    }
                  ],
                  [
                    {
                      "text": "19- Ø±Ø­Ù…Ø§Ù† Ø´Ù…Ø³ÛŒ",
                      "callback_data": "tovote^6987405825"
                    },
                    {
                      "text": "20- Ø¹Ù„ÛŒ Ù¾ÙˆØ±Ø¨Ù‡Ø±ÙˆØ²Ø§Ù†",
                      "callback_data": "tovote^70833892"
                    }
                  ],
                  [
                    {
                      "text": "21- Ù…Ø­Ù…Ø¯Ø±Ø¶Ø§ Ù…Ù‡Ø§Ø¬Ø±Ù†ÛŒØ§",
                      "callback_data": "tovote^92903851"
                    },
                    {
                      "text": "22- Ø¢ÙˆØ§ Ù‚Ø§Ø³Ù…ÛŒ",
                      "callback_data": "tovote^7415375623"
                    }
                  ],
                  [
                    {
                      "text": "23- Ø¹Ù„ÛŒ Ù…Ø¹Ù…Ø§Ø±ÛŒ",
                      "callback_data": "tovote^121713560"
                    },
                    {
                      "text": "24-  Ù…ÛŒÙ„Ø§Ø¯ Ù†ÛŒÚ© Ø¢Ø²Ù…Ø§",
                      "callback_data": "tovote^5616348466"
                    }
                  ],
                  [
                    {
                      "text": "25- Ø³Ù¾Ù‡Ø± Ø´Ø¹Ø¨Ø§Ù†ÛŒ",
                      "callback_data": "tovote^1816545723"
                    },
                    {
                      "text": "26- Ø§Ø­Ù…Ø¯ Ú©Ù…Ø§Ù„ÛŒ",
                      "callback_data": "tovote^7091595139"
                    }
                  ],
                  [
                    {
                      "text": "27- Ø¹Ù„ÛŒ Ù¾ÙˆØ± Ø¨Ù‡Ø±ÙˆØ²Ø§Ù†",
                      "callback_data": "tovote^7868874927"
                    },
                    {
                      "text": "28- Ù…Ø¬ÛŒØ¯ ÙØ§Ø¶Ù„ÛŒ",
                      "callback_data": "tovote^416031526"
                    }
                  ],
                  [
                    {
                      "text": "29- Ø¹Ù„ÛŒ Ø¯Ù‡Ù‚Ø§Ù†ÛŒ",
                      "callback_data": "tovote^1003089783"
                    },
                    {
                      "text": "30- Ø­Ø§Ù…Ø¯ Ù‚Ø±Ø¨Ø§Ù†ÛŒ",
                      "callback_data": "tovote^191620139"
                    }
                  ],
                  [
                    {
                      "text": "31- ÙØ±Ø²ÛŒÙ† Ù…Ø¬Ø¯",
                      "callback_data": "tovote^6010489050"
                    },
                    {
                      "text": "32- Ø­Ø³ÛŒÙ† Ø¹Ø±Ø¨",
                      "callback_data": "tovote^1737639707"
                    }
                  ],
                  [
                    {
                      "text": "33- ÙØ§Ø·Ù…Ù‡ ÙØ±Ù…Ø§Ù† Ø²Ø§Ø¯Ù‡",
                      "callback_data": "tovote^7560974272"
                    },
                    {
                      "text": "34- Ø±Ø¶Ø§ Ø®Ù„Ø¹ØªØ¨Ø±ÛŒ",
                      "callback_data": "tovote^815221436"
                    }
                  ],
                  [
                    {
                      "text": "35- Ù…ØµØ·ÙÛŒ Ø·Ø­Ø§Ù† Ù†Ú˜Ø§Ø¯ ",
                      "callback_data": "tovote^1453634941"
                    },
                    {
                      "text": "36- Ø¹Ù„ÛŒ Ø§Ø­Ù…Ø¯ÛŒ",
                      "callback_data": "tovote^97650917"
                    }
                  ],
                  [
                    {
                      "text": "37- ØªÙˆØ­ÛŒØ¯ Ù„Ø·ÙÛŒ",
                      "callback_data": "tovote^46059517"
                    },
                    {
                      "text": "38- Ù…Ø­Ø³Ù† Ø±Ø¬Ø¨ÛŒ Ú¯Ù„Ù…Ù‡Ø±",
                      "callback_data": "tovote^185330596"
                    }
                  ],
                  [
                    {
                      "text": "39- Ø­Ù…ÛŒØ¯ Ø´Ù‡Ø¨Ø§Ø±ÛŒ",
                      "callback_data": "tovote^103743033"
                    },
                    {
                      "text": "40- Ø§Ù…ÛŒÙ† ÙØ§Ø·Ù…ÛŒ",
                      "callback_data": "tovote^74979638"
                    }
                  ],
                  [
                    {
                      "text": "41- Ù…Ø¬ØªØ¨ÛŒ Ø´Ø§Ù‚ÛŒ",
                      "callback_data": "tovote^6693154859"
                    },
                    {
                      "text": "42- Ù¾ÙˆÛŒØ§ Ø±Ø­ÛŒÙ…ÛŒ",
                      "callback_data": "tovote^7709912372"
                    }
                  ],
                  [
                    {
                      "text": "43- Ø¹Ù„ÛŒ Ø®Ø§Ù†Ú†Ø±Ù„ÛŒ",
                      "callback_data": "tovote^315867518"
                    },
                    {
                      "text": "44- Ø²Ù‡Ø±Ø§ Ù‡Ø§Ø´Ù…ÛŒØ§Ù† Ù¾ÙˆØ±",
                      "callback_data": "tovote^180497899"
                    }
                  ],
                  [
                    {
                      "text": "45- Ù…Ø¬ÛŒØ¯ Ø³ÛŒÙÛŒ",
                      "callback_data": "tovote^5734904638"
                    },
                    {
                      "text": "46- Ø§Ù…ÛŒÙ† Ù‡ÙˆØ§Ø³ÛŒ",
                      "callback_data": "tovote^368739228"
                    }
                  ],
                  [
                    {
                      "text": "47- ÙØ§Ø·Ù…Ù‡ Ø§Ø¬ÛŒÙ„ÛŒ",
                      "callback_data": "tovote^106583524"
                    },
                    {
                      "text": "48- Ù…Ø­Ù…Ø¯Ø¬ÙˆØ§Ø¯ Ù…ÙˆØ³ÙˆÛŒ",
                      "callback_data": "tovote^101250034"
                    }
                  ],
                  [
                    {
                      "text": "49- Ù…Ø­Ø³Ù† Ú©Ù‡Ù†Ø¯Ø§Ù†ÛŒ",
                      "callback_data": "tovote^135819842"
                    },
                    {
                      "text": "50- Ù…Ù‡Ø¯ÛŒ Ø§Ø¹ØªÙ…Ø§Ø¯ÛŒ",
                      "callback_data": "tovote^1985282555"
                    }
                  ],
                  [
                    {
                      "text": "51- Ø¢Ø±Ø´ Ù…Ù„Ú© ØªØ§Ø¬ÛŒ",
                      "callback_data": "tovote^5124754671"
                    },
                    {
                      "text": "52- Ù…Ø­Ù…Ø¯ Ø¨Ù‡Ù…Ù†ÛŒØ§Ø±",
                      "callback_data": "tovote^6741300396"
                    }
                  ],
                  [
                    {
                      "text": "53- Ù…Ø­Ù…Ø¯Ø§Ù…ÛŒÙ† Ú†Ø±Ø§ØºÛŒØ§Ù†",
                      "callback_data": "tovote^882730020"
                    },
                    {
                      "text": "54- Ø­Ø³Ø§Ù… Ù‚Ø¯ÛŒØ±ÛŒ",
                      "callback_data": "tovote^6434872716"
                    }
                  ],
                  [
                    {
                      "text": "55- Ù…ØµØ·ÙÛŒ Ø¹Ø³Ú©Ø±ÛŒ",
                      "callback_data": "tovote^1132635555"
                    },
                    {
                      "text": "56- Ø­Ù…ÛŒØ¯ Ø´Ù‡Ø¨Ø§Ø²ÛŒ",
                      "callback_data": "tovote^5914461309"
                    }
                  ],
                  [
                    {
                      "text": "57- Ù†ÙˆØ± Ø³Ø¬Ø§Ø¯ÛŒ",
                      "callback_data": "tovote^7146836414"
                    },
                    {
                      "text": "58- Ø­Ø³ÛŒÙ† Ø²Ø±Ú¯Ø±",
                      "callback_data": "tovote^192204657"
                    }
                  ],
                  [
                    {
                      "text": "59- Ù…Ø­Ù…Ø¯ Ù„Ø§Ø¬ÙˆØ±Ø¯ÛŒ",
                      "callback_data": "tovote^6316472362"
                    },
                    {
                      "text": "60- Ù…ÛŒÙ†Ø§ Ù…ÛŒØ±Ø¬Ù„ÛŒÙ„ÛŒ",
                      "callback_data": "tovote^88094478"
                    }
                  ],
                  [
                    {
                      "text": "61- ÙØ§Ø·Ù…Ù‡ Ù†Ø§ØµØ±ÛŒ",
                      "callback_data": "tovote^5090731432"
                    },
                    {
                      "text": "62- ÙØ§Ø·Ù…Ù‡ Ù†Ù…Ø§Ø²ÛŒØ§Ù†",
                      "callback_data": "tovote^5725831272"
                    }
                  ],
                  [
                    {
                      "text": "63- Ù…Ù‡Ø¯ÛŒ ØºÙ„Ø§Ù…ÛŒ",
                      "callback_data": "tovote^241885704"
                    },
                    {
                      "text": "64- Ù…Ø­Ù…Ø¯Ø±Ø¶Ø§ Ø¬Ù‡Ø§Ù†â€Œ Ù†Ù…Ø§",
                      "callback_data": "tovote^410271064"
                    }
                  ],
                  [
                    {
                      "text": "Â» Ø¨Ø§Ø²Ú¯Ø´Øª",
                      "callback_data": "userpanel^"
                    }
                  ]
                ]
              }
            },
            "chat_instance": "3357931565458170169",
            "data": "tovote^150800621"
          }
        }
      }
    ]
  },
  "connections": {
    "Check_Message_type": {
      "main": [
        [
          {
            "node": "Merge Switcher data",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Merge Switcher text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Channel User": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Check Creator",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Check_Message_type",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Creator": {
      "main": [
        [
          {
            "node": "LINK JOIN",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Check_Message_type",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SIMORGH": {
      "main": [
        [
          {
            "node": "BOT INFO",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BOT INFO": {
      "main": [
        [
          {
            "node": "Check User Exist List",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Make Menu Message",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Make query",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Make Menu Message": {
      "main": [
        [
          {
            "node": "SEND result Click Menu Layer 1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Make query": {
      "main": [
        [
          {
            "node": "Request-to-db",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Make Menu Message2": {
      "main": [
        [
          {
            "node": "SEND result Click Menu Layer 2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Request-to-db": {
      "main": [
        [
          {
            "node": "Make Menu Message2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge Switcher data": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge Switcher text": {
      "main": [
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch1": {
      "main": [
        [
          {
            "node": "Make Menu Message1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Make Menu Message3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Confirm_Make_Menu_Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Make Menu Message1": {
      "main": [
        [
          {
            "node": "SEND result Click Menu Layer ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SEND result Click Menu Layer ": {
      "main": [
        []
      ]
    },
    "Make Menu Message3": {
      "main": [
        [
          {
            "node": "SEND result Click Menu Layer 3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SEND result Click Menu Layer 3": {
      "main": [
        []
      ]
    },
    "Check User Exist List": {
      "main": [
        [
          {
            "node": "IF EXIST True",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF EXIST True": {
      "main": [
        [
          {
            "node": "Check Channel User",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "SEND Reject Message To-User",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SEND Reject Message To-User": {
      "main": [
        [
          {
            "node": "Notify admin",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Confirm_Make_Menu_Message": {
      "main": [
        [
          {
            "node": "SEND result Click Menu Layer 4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SEND result Click Menu Layer 4": {
      "main": [
        [
          {
            "node": "Telegram",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SEND result Click Menu Layer 2": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Send To Ch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send To Ch": {
      "main": [
        [
          {
            "node": "INSERT Message id",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send To User": {
      "main": [
        []
      ]
    },
    "INSERT Message id": {
      "main": [
        [
          {
            "node": "Send To User",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "User info": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "OpenAI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "User info",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI": {
      "main": [
        [
          {
            "node": "Send To Ch1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send To Ch1": {
      "main": [
        [
          {
            "node": "Send Message To user",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "saveDataErrorExecution": "all",
    "callerPolicy": "workflowsFromSameOwner",
    "timezone": "Asia/Tehran"
  },
  "versionId": "54f7e386-b990-460b-9184-cbfd5cfa576c",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "ae97ba35770b76a9a65a530931f4cf26a9e56cda380a49b095c8aa5a31c5bd2a"
  },
  "id": "iVwF09H8Vqx0zlc0",
  "tags": []
}